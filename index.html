<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Jimbray">
<meta property="og:url" content="http://jimbray.github.io/index.html">
<meta property="og:site_name" content="Jimbray">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jimbray">
<meta name="twitter:description">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> Jimbray </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-78813427-1', 'auto');
  ga('send', 'pageview');
</script>







  <div style="display: none;">
    <script src="http://s6.cnzz.com/stat.php?id=1259500890&web_id=1259500890" type="text/javascript"></script>
  </div>





  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Jimbray</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">It is a short story</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-apps">
          <a href="/apps" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            应用
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/06/suppriseBottomView/" itemprop="url">
                  ScrollView 与 ViewDragHelper 的混合使用学习
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-01-06T20:20:02+08:00" content="2017-01-06">
              2017-01-06
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/01/06/suppriseBottomView/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/06/suppriseBottomView/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>按照惯例，先上效果</p>
<p><img src="http://7xv11f.com1.z0.glb.clouddn.com/suppriseBottomView.gif" alt=""></p>
<h3 id="涉及到的知识点"><a href="#涉及到的知识点" class="headerlink" title="涉及到的知识点"></a>涉及到的知识点</h3><ul>
<li><p><code>ViewGroup</code> 的事件分发拦截机制</p>
</li>
<li><p><code>ViewDragHelper</code> 的基本使用</p>
</li>
</ul>
<h4 id="ViewGroup-的事件分发拦截机制"><a href="#ViewGroup-的事件分发拦截机制" class="headerlink" title="ViewGroup 的事件分发拦截机制"></a><code>ViewGroup</code> 的事件分发拦截机制</h4><p><code>ViewGroup</code> 有三个方法</p>
<ol>
<li><code>dispatchTouchEvent</code></li>
<li><code>onInterceptTouchEvent</code></li>
<li><code>onTouchEvent</code></li>
</ol>
<h5 id="dispatchTouchEvent"><a href="#dispatchTouchEvent" class="headerlink" title="dispatchTouchEvent"></a>dispatchTouchEvent</h5><p>用于<code>touch</code>事件的分发；通俗点说，就是决定当前这个<code>touch</code>事件应该交给谁来处理（是当前<code>View</code>还是父<code>View</code>）</p>
<blockquote>
<p>当触摸事件发生时 <code>Activity</code> 的 <code>dispatchTouchEvent(MotionEvent ev)</code> 方法会从根元素依次往下传递直到最内层子元素或在中间某一元素中事件被拦截或者消费.</p>
<p>如果 <code>return true</code>，事件会分发给当前 <code>View</code> 并由 <code>dispatchTouchEvent</code> 方法进行消费，同时事件会停止向下传递；这样该<code>View</code>的<code>onTouchEvent</code>事件也不会得到响应.<br>如果<code>return false</code>，会将事件返回给父 <code>View</code> 的 <code>onTouchEvent</code> 进行消费。<br>如果 <code>return super.dispatchTouchEvent(ev)</code>，事件会分发给当前 <code>View</code> 的 <code>onInterceptTouchEvent</code> 方法去进行处理。</p>
</blockquote>
<h5 id="onInterceptTouchEvent"><a href="#onInterceptTouchEvent" class="headerlink" title="onInterceptTouchEvent"></a>onInterceptTouchEvent</h5><p>用于<code>touch</code>事件的拦截；通俗点说，就是决定刚刚 <code>dispatchTouchEvent</code> 抛给我的<code>touch</code>事件应该交给谁来处理（是当前<code>View</code>还是子<code>View</code>）<em>注意跟<code>dispatchTouchEvent</code>的区别</em></p>
<blockquote>
<p>如果 <code>return true</code>，则将事件进行拦截，并将拦截到的事件交由该 <code>View</code> 的 <code>onTouchEvent</code> 进行处理；<br>如果 <code>return false</code>，则将事件向子<code>View</code>传递，再由子<code>View</code>的 <code>dispatchTouchEvent</code>来对这个事件处理；<br>如果 <code>return super.onInterceptTouchEvent(ev)</code>，事件会被拦截，并将事件交由该 <code>View</code> 的 <code>onTouchEvent</code> 进行处理。</p>
</blockquote>
<h5 id="onTouchEvent"><a href="#onTouchEvent" class="headerlink" title="onTouchEvent"></a>onTouchEvent</h5><p>用于touch事件的处理；通俗点说，就是决定刚刚 onInterceptTouchEvent 抛给我的touch事件进行处理（<del>这锅实在没得甩了</del> 还可以甩给父类，科科）</p>
<blockquote>
<p>如果<code>return false</code>，那么这个事件会从该 <code>View</code> 向父<code>View</code>传递，父 <code>View</code> 的 <code>onTouchEvent</code> 来接收，而且如果父<code>View</code>也是<code>return false</code>，那事件也会向上传递由<code>onTouchEvent</code>接收处理.<br>如果<code>retrun true</code>， 则会接收并消费该事件。<br>如果<code>retrun super.onTouchEvent(ev)</code> 和返回 false 时相同。</p>
</blockquote>
<h4 id="ViewDragHelper-的基本使用"><a href="#ViewDragHelper-的基本使用" class="headerlink" title="ViewDragHelper 的基本使用"></a>ViewDragHelper 的基本使用</h4><ol>
<li>创建实例</li>
<li><code>Touch</code> 事件分发拦截的相关处理</li>
<li><code>ViewDragHelper callback</code> 的实现</li>
</ol>
<p><code>ViewDragHelper</code> 的出现就是为了减轻 开发者实现拖拽行为功能 的负担，所以很简单的几个方法就可以做出<del>很好的效果</del>比以前用<code>onTouchEvent</code>自己写得要死要活的效果还要好。</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2017/01/06/suppriseBottomView/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/28/one-key post-to-facebook/" itemprop="url">
                  Android 一键发布 Facebook 帖文
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-12-28T13:00:00+08:00" content="2016-12-28">
              2016-12-28
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/12/28/one-key post-to-facebook/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/28/one-key post-to-facebook/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>一般遇到的需求都是做分享操作，现在国内已经有很多一键分享的 SDK了，而且还封装得不错，就是权限要得比较多。</p>
<p>今天需要做的是  跟 Path APP 一样，在自己的 APP 发布post时，同步发送到 <del>其他平台</del>Facebook。</p>
<h3 id="先把基本配置做了"><a href="#先把基本配置做了" class="headerlink" title="先把基本配置做了"></a>先把基本配置做了</h3><blockquote>
<ul>
<li>將 <strong>Facebook Android SDK</strong> 新增至您的行動開發環境</li>
<li>取得正確設定並連結至 Android 應用程式的 <strong>Facebook 應用程式編號</strong>。請參閱 <a href="https://developers.facebook.com/docs/android/getting-started#app_id">Android 新手指南，新增 Facebook 應用程式編號</a></li>
<li>產生 <strong>Android 金鑰雜湊</strong>並新增至<a href="https://developers.facebook.com/settings/developer/contact/">開發人員個人檔案</a></li>
<li><strong>新增 Facebook Activity</strong> - 請將本項目加至 `AndroidManifest.xml</li>
</ul>
</blockquote>
<h3 id="开始分享"><a href="#开始分享" class="headerlink" title="开始分享"></a>开始分享</h3><h4 id="建立内容模板"><a href="#建立内容模板" class="headerlink" title="建立内容模板"></a>建立内容模板</h4><p>模板有几种方式</p>
<ul>
<li>Link</li>
<li>Photos</li>
<li>Videos</li>
<li>Multimedia</li>
</ul>
<p>参见<a href="https://developers.facebook.com/docs/sharing/android?locale=en_US">Facebook官方文档</a></p>
<h4 id="最终使用"><a href="#最终使用" class="headerlink" title="最终使用"></a>最终使用</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ShareApi.share(content, null);</span><br></pre></td></tr></table></figure>
<p>即可发送成功</p>
<p>但是发送的样式 跟 使用那些 一键分享的 SDK 是一样的</p>
<p>都是那种感觉像 转发 的形式。（会看到 发送的对话框，类似于 ShareDialog）</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/12/28/one-key post-to-facebook/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/14/my-second-custom-view/" itemprop="url">
                  我的第二个自定义View
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-14T15:19:05+08:00" content="2016-07-14">
              2016-07-14
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/14/my-second-custom-view/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/14/my-second-custom-view/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>自古以来，第一个总是抢走了所有的聚光灯。<br>怎么办，我是第二个。</p>
<p>据说有一个国际惯例，要真相<br>那就来吧<br><img src="http://7xv11f.com1.z0.glb.clouddn.com/my-second-custom-view.gif" alt="真相"></p>
<p>看到了吗。<br>下边那个圆环就是我们第二个主角啦。<br>上面那个是 传说中的第一个。<br>没办法，第二个不管再怎么好看也比不上 号称第一的那位。<br>这，应该是一个诅咒。<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Created by Jimbray  .</span><br><span class="line"> * on 2016/7/13</span><br><span class="line"> * Email: jimbray16@gmail.com</span><br><span class="line"> * Description: 这是我第二个自定义View。</span><br><span class="line"> * 第一个永远是被人铭记的，可是第二个呢</span><br><span class="line"> * 问你一个问题：世界上最高的山峰是？</span><br><span class="line"> * 答：当然是珠穆朗玛峰啦！</span><br><span class="line"> * 那第二高的呢？</span><br><span class="line"> * 答：当然是乔戈里峰啦！</span><br><span class="line"> * -_- 你不按套路出牌啊，套路里你是不知道的！</span><br><span class="line"> */</span><br><span class="line">public class MySecondProgressbar extends View &#123;</span><br><span class="line"></span><br><span class="line">    private Context mContext;</span><br><span class="line"></span><br><span class="line">    // 准备好画圆环的矩形区域</span><br><span class="line">    private RectF mRectF = new RectF(0, 0, 0, 0);</span><br><span class="line">    // 准备好画文字的矩形区域</span><br><span class="line">    private RectF mTextRrectF = new RectF(0, 0, 0, 0);</span><br><span class="line"></span><br><span class="line">    // 握好画笔啊，有三个频段，还有一个文字</span><br><span class="line">    private Paint mHeavyProgressPaint, mModerateProgressPaint, mLightProgressPaint, mTextPaint;</span><br><span class="line"></span><br><span class="line">    // 默认值设置</span><br><span class="line">    private final float default_height  = dp2px(45);</span><br><span class="line">    private final float default_width   = dp2px(45);</span><br><span class="line">    private final int default_heavy_color = Color.rgb(255, 54, 102);</span><br><span class="line">    private final int default_moderate_color = Color.rgb(255, 128, 97);</span><br><span class="line">    private final int default_light_color = Color.rgb(8, 176, 242);</span><br><span class="line">    private final int default_text_color = Color.rgb(0, 0, 0);</span><br><span class="line">    private final float default_text_size = sp2px(14);</span><br><span class="line">    private final float default_heavy_progress_width = dp2px(12);</span><br><span class="line">    private final float defaule_moderate_progress_width = dp2px(12);</span><br><span class="line">    private final float default_light_progress_width = dp2px(12);</span><br><span class="line"></span><br><span class="line">    //三个频段，三种颜色啊，还有一个是字体颜色</span><br><span class="line">    private int mHeavyColor, mModerateColor, mLightColor, mTextColor;</span><br><span class="line">    //画的东西宽高，还是给个默认值好了</span><br><span class="line">    private float mViewHeight, mViewWidth;</span><br><span class="line">    //我们画的是圆环，要多粗有多粗，定海神针，啊不，定海神环</span><br><span class="line">    private float mHeavyProgressWidth, mModerateProgressWidth, mLightProgresswidth;</span><br><span class="line"></span><br><span class="line">    private boolean mIfDrawText; //是不是要画一下中间的文字呢。还是 写</span><br><span class="line">    private String mCurrentDrawText; //画的文字你得告诉我吧</span><br><span class="line">    private float mTextSize; //字别太大，会撑着</span><br><span class="line">    private int mTextBaseLine; //这个 我是抄的</span><br><span class="line"></span><br><span class="line">    private float mCircleOffset = dp2px(15); //人与人之间的距离不要太近，还是要有一定的安全距离。不然亲上了怎么办。</span><br><span class="line"></span><br><span class="line">    private float mCurrentProgress; //这第二个自定义View还是一个progressbar</span><br><span class="line">    private float mCurHeavy, mCurModerate, mCurLight; //三个频段，三个单词是突然想到的，不知道什么意思</span><br><span class="line"></span><br><span class="line">    public enum MySecondProgressTextVisibility &#123;// 跟第一个自定义View最大的不同就是 ：名字</span><br><span class="line">        Visible, Invisible</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public MySecondProgressbar(Context context) &#123;</span><br><span class="line">        super(context);</span><br><span class="line">        init(context, null, 0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public MySecondProgressbar(Context context, AttributeSet attrs) &#123;</span><br><span class="line">        super(context, attrs);</span><br><span class="line">        init(context, attrs, 0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public MySecondProgressbar(Context context, AttributeSet attrs, int defStyleAttr) &#123;</span><br><span class="line">        super(context, attrs, defStyleAttr);</span><br><span class="line">        init(context, attrs, defStyleAttr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *</span><br><span class="line">     * 不想解释</span><br><span class="line">     * @param context</span><br><span class="line">     * @param attrs</span><br><span class="line">     * @param defStyleAttr</span><br><span class="line">     */</span><br><span class="line">    private void init(Context context, AttributeSet attrs, int defStyleAttr) &#123;</span><br><span class="line">        this.mContext = context;</span><br><span class="line"></span><br><span class="line">        mHeavyColor = default_heavy_color;</span><br><span class="line">        mModerateColor = default_moderate_color;</span><br><span class="line">        mLightColor = default_light_color;</span><br><span class="line">        mTextColor = default_text_color;</span><br><span class="line"></span><br><span class="line">        mViewWidth = default_width;</span><br><span class="line">        mViewHeight = default_height;</span><br><span class="line"></span><br><span class="line">        mTextSize = default_text_size;</span><br><span class="line"></span><br><span class="line">        mHeavyProgressWidth = default_heavy_progress_width;</span><br><span class="line">        mModerateProgressWidth = defaule_moderate_progress_width;</span><br><span class="line">        mLightProgresswidth = default_light_progress_width;</span><br><span class="line"></span><br><span class="line">        mIfDrawText = true;</span><br><span class="line"></span><br><span class="line">        initPainters();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 上颜料</span><br><span class="line">     */</span><br><span class="line">    private void initPainters() &#123;</span><br><span class="line">        mHeavyProgressPaint = new Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        mHeavyProgressPaint.setColor(mHeavyColor);</span><br><span class="line">        mHeavyProgressPaint.setStyle(Paint.Style.STROKE);</span><br><span class="line">        mHeavyProgressPaint.setStrokeWidth(mHeavyProgressWidth);</span><br><span class="line"></span><br><span class="line">        mModerateProgressPaint = new Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        mModerateProgressPaint.setColor(mModerateColor);</span><br><span class="line">        mModerateProgressPaint.setStyle(Paint.Style.STROKE);</span><br><span class="line">        mModerateProgressPaint.setStrokeWidth(mModerateProgressWidth);</span><br><span class="line"></span><br><span class="line">        mLightProgressPaint = new Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        mLightProgressPaint.setColor(mLightColor);</span><br><span class="line">        mLightProgressPaint.setStyle(Paint.Style.STROKE);</span><br><span class="line">        mLightProgressPaint.setStrokeWidth(mLightProgresswidth);</span><br><span class="line"></span><br><span class="line">        mTextPaint = new Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        mTextPaint.setColor(mTextColor);</span><br><span class="line">        mTextPaint.setTextAlign(Paint.Align.CENTER);</span><br><span class="line">        mTextPaint.setTextSize(mTextSize);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 最小宽度 由你定</span><br><span class="line">     * 不定我来给个最小值吧</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    protected int getSuggestedMinimumWidth() &#123;</span><br><span class="line">        return (int) mViewWidth;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 跟宽度一个意思</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    protected int getSuggestedMinimumHeight() &#123;</span><br><span class="line">        return (int) mViewHeight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * @param canvas</span><br><span class="line">     * 咱先分析一下</span><br><span class="line">     * 要画什么</span><br><span class="line">     * 我要画一个圆环</span><br><span class="line">     * 圆环里面有三个频段的显示（不同颜色）</span><br><span class="line">     * 这三个频段呢，分别代表三个数值的占比关系</span><br><span class="line">     * 中间放个文字吧，不然太空</span><br><span class="line">     * 好像就这样</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    protected void onDraw(Canvas canvas) &#123;</span><br><span class="line">        if(mIfDrawText) &#123;</span><br><span class="line">            calWithText();</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            calWithoutText();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //上面已经把我们要画的区域圈出来了</span><br><span class="line">        //可以施展拳脚，不对，是画笔了</span><br><span class="line"></span><br><span class="line">        float heavy_sweep_angle = mCurHeavy / mCurrentProgress; //算一下占比</span><br><span class="line">        heavy_sweep_angle = heavy_sweep_angle * 360; //占比最终还是要转换成角度的，0.5的话就是180度</span><br><span class="line">        if(mCurHeavy != 0) &#123;</span><br><span class="line">            //从上面12点钟的位置开始，就是270啦，我不喜欢负数，扫过多大的角度呢</span><br><span class="line">            canvas.drawArc(mRectF, 270, heavy_sweep_angle, false, mHeavyProgressPaint); //试试把false改为true玩一玩，顺便把paint 的stroke属性去掉。有惊喜哦！</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //跟上面的意思差不多啦。</span><br><span class="line">        float moderate_sweep_angle = mCurModerate / mCurrentProgress;</span><br><span class="line">        moderate_sweep_angle = moderate_sweep_angle * 360;</span><br><span class="line">        if(mCurModerate != 0) &#123;</span><br><span class="line">            canvas.drawArc(mRectF, 270 + heavy_sweep_angle, moderate_sweep_angle, false, mModerateProgressPaint);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //还是一样的。</span><br><span class="line">        float light_sweep_angle = mCurLight / mCurrentProgress;</span><br><span class="line">        light_sweep_angle = light_sweep_angle * 360;</span><br><span class="line">        if(mCurLight != 0) &#123;</span><br><span class="line">            canvas.drawArc(mRectF, 270 + heavy_sweep_angle + moderate_sweep_angle, light_sweep_angle, false, mLightProgressPaint);</span><br><span class="line">        &#125;</span><br><span class="line">        //上面已经把圆环都画完了</span><br><span class="line"></span><br><span class="line">        //画个原点，我是来确定我写的字是不是在中间，不能我说在中间就是在中间是吧。如果它不是在中间，我把它说成在中间，然后被你发现它不在中间，那我不是很尴尬。</span><br><span class="line">//        canvas.drawOval(getWidth() /2 - 1 , getHeight() / 2 - 1, getWidth() / 2 + 1, getHeight() / 2 + 1, mHeavyProgressPaint); //画个圆点，看看文字是不是居中的</span><br><span class="line"></span><br><span class="line">        if(mIfDrawText) &#123; //准备书法</span><br><span class="line"></span><br><span class="line">//            canvas.drawRect(mTextRrectF, mLightProgressPaint); //画个矩形 把text 框起来 ,参照物</span><br><span class="line">            //第一种</span><br><span class="line">            //这个是不对的做法，我以为是写在了中间</span><br><span class="line">//            canvas.drawText(mCurrentDrawText, getWidth() / 2.0f, getHeight() / 2.0f + (mTextPaint.descent() + mTextPaint.ascent()), mTextPaint);</span><br><span class="line"></span><br><span class="line">            //第二种</span><br><span class="line">            // 后来我知道我错了，所以我就将错就错，再错一次</span><br><span class="line">//            float text_width = mTextPaint.measureText(mCurrentDrawText);</span><br><span class="line">//            canvas.drawText(mCurrentDrawText, mTextRrectF.left + text_width/2.0f, mTextRrectF.bottom, mTextPaint);</span><br><span class="line"></span><br><span class="line">            //第三种</span><br><span class="line">            //又来了!快看我找到的解决方案：[等灯等灯](http://blog.csdn.net/hursing/article/details/18703599)</span><br><span class="line">            canvas.drawText(mCurrentDrawText, mTextRrectF.centerX(), mTextBaseLine, mTextPaint);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 精华1</span><br><span class="line">     * 这里不写字</span><br><span class="line">     */</span><br><span class="line">    private void calWithoutText() &#123;</span><br><span class="line">        mRectF.left = getPaddingLeft() + mCircleOffset;</span><br><span class="line">        mRectF.top = getPaddingTop() + mCircleOffset;</span><br><span class="line">        mRectF.right = getWidth() - getPaddingRight() - mCircleOffset;</span><br><span class="line">        mRectF.bottom = getHeight() - getPaddingBottom() - mCircleOffset;</span><br><span class="line"></span><br><span class="line">        //就完啦？</span><br><span class="line">        //你说的对呀</span><br><span class="line">        //我就确定个区域，咋滴啦</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 精华2</span><br><span class="line">     */</span><br><span class="line">    private void calWithText() &#123;</span><br><span class="line">        mRectF.left = getPaddingLeft() + mCircleOffset;</span><br><span class="line">        mRectF.top = getPaddingTop() + mCircleOffset;</span><br><span class="line">        mRectF.right = getWidth() - getPaddingRight() - mCircleOffset;</span><br><span class="line">        mRectF.bottom = getHeight() - getPaddingBottom() - mCircleOffset;</span><br><span class="line"></span><br><span class="line">        if(!TextUtils.isEmpty(mCurrentDrawText)) &#123;</span><br><span class="line">            float text_width = mTextPaint.measureText(mCurrentDrawText);</span><br><span class="line">            mTextRrectF.left = getWidth() / 2.0f - text_width / 2.0f;</span><br><span class="line">            mTextRrectF.top = getHeight() / 2.0f - mTextSize / 2.0f;</span><br><span class="line">            mTextRrectF.right = getWidth() / 2.0f + text_width / 2.0f;</span><br><span class="line">            mTextRrectF.bottom = getHeight() / 2.0f + mTextSize / 2.0f;</span><br><span class="line"></span><br><span class="line">            //这里是计算 文字居中的解决方案 具体请访问我搜到的 [这是我找到的](http://blog.csdn.net/hursing/article/details/18703599)</span><br><span class="line">            Paint.FontMetricsInt fontMetrics = mTextPaint.getFontMetricsInt();</span><br><span class="line">            mTextBaseLine = (int) ((mTextRrectF.bottom + mTextRrectF.top - fontMetrics.bottom - fontMetrics.top) / 2);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            mIfDrawText = false;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //这里还是确定个区域的问题</span><br><span class="line">        //只不过多了文字的区域</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 这个套路还是可以再深一点</span><br><span class="line">     * 不过我是新司机</span><br><span class="line">     * 不会换档</span><br><span class="line">     * @param widthMeasureSpec</span><br><span class="line">     * @param heightMeasureSpec</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;</span><br><span class="line">        setMeasuredDimension(measure(widthMeasureSpec, true), measure(heightMeasureSpec, false));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 测量 view 的 宽高信息</span><br><span class="line">     * @param measureSpec</span><br><span class="line">     * @param isWidth</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    private int measure(int measureSpec, boolean isWidth) &#123;</span><br><span class="line">        int result;</span><br><span class="line">        int mode = MeasureSpec.getMode(measureSpec);</span><br><span class="line">        int size = MeasureSpec.getSize(measureSpec);</span><br><span class="line">        int padding = isWidth ? getPaddingLeft() + getPaddingRight() : getPaddingTop() + getPaddingBottom();</span><br><span class="line">        if (mode == MeasureSpec.EXACTLY) &#123;</span><br><span class="line">            result = size;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            result = isWidth ? getSuggestedMinimumWidth() : getSuggestedMinimumHeight();</span><br><span class="line">            result += padding;</span><br><span class="line">            if (mode == MeasureSpec.AT_MOST) &#123;</span><br><span class="line">                if (isWidth) &#123;</span><br><span class="line">                    result = Math.max(result, size);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    result = Math.min(result, size);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public float dp2px(float dp) &#123;</span><br><span class="line">        final float scale = getResources().getDisplayMetrics().density;</span><br><span class="line">        return dp * scale + 0.5f;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public float sp2px(float sp) &#123;</span><br><span class="line">        final float scale = getResources().getDisplayMetrics().scaledDensity;</span><br><span class="line">        return sp * scale;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void setProgressTextVisibility(MySecondProgressTextVisibility visibility) &#123;</span><br><span class="line">        mIfDrawText = visibility == MySecondProgressTextVisibility.Visible;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setProgress(float heavy, float moderate, float light) &#123;</span><br><span class="line">        this.mCurrentProgress = heavy + moderate + light;</span><br><span class="line">        this.mCurHeavy = heavy;</span><br><span class="line">        this.mCurModerate = moderate;</span><br><span class="line">        this.mCurLight = light;</span><br><span class="line">        invalidate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 加个动画</span><br><span class="line">     * 就会变成屌屌的</span><br><span class="line">     * 我知道我为什么选progressbar来做第一个自定义View了</span><br><span class="line">     * 因为</span><br><span class="line">     * 其他的我也不会啊</span><br><span class="line">     * @param heavy</span><br><span class="line">     * @param moderate</span><br><span class="line">     * @param light</span><br><span class="line">     */</span><br><span class="line">    public void animProgress(float heavy, float moderate, float light) &#123;</span><br><span class="line">        this.mCurrentProgress = heavy + moderate + light;</span><br><span class="line"></span><br><span class="line">        ValueAnimator heavy_animator = ValueAnimator.ofFloat(0, heavy);</span><br><span class="line">        heavy_animator.setInterpolator(new LinearInterpolator());</span><br><span class="line">        heavy_animator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onAnimationUpdate(ValueAnimator animation) &#123;</span><br><span class="line">                mCurHeavy = (float) animation.getAnimatedValue();</span><br><span class="line">                postInvalidate();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        ValueAnimator moderate_animator = ValueAnimator.ofFloat(0, moderate);</span><br><span class="line">        moderate_animator.setInterpolator(new LinearInterpolator());</span><br><span class="line">        moderate_animator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onAnimationUpdate(ValueAnimator animation) &#123;</span><br><span class="line">                mCurModerate = (float) animation.getAnimatedValue();</span><br><span class="line">                postInvalidate();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        ValueAnimator light_animator = ValueAnimator.ofFloat(0, light);</span><br><span class="line">        light_animator.setInterpolator(new LinearInterpolator());</span><br><span class="line">        light_animator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onAnimationUpdate(ValueAnimator animation) &#123;</span><br><span class="line">                mCurLight = (float) animation.getAnimatedValue();</span><br><span class="line">                postInvalidate();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        AnimatorSet animSet = new AnimatorSet();</span><br><span class="line">        animSet.setDuration(1000);</span><br><span class="line">        animSet.playTogether(light_animator, moderate_animator, heavy_animator);</span><br><span class="line">        animSet.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setProgressText(String text) &#123;</span><br><span class="line">        this.mCurrentDrawText = text;</span><br><span class="line">        invalidate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>第二个也写完了。<br>这个我没有抄别人的啊。<br>我抄的是第一个自定义View 的。<br>敲完了。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/07/13/my-first-custom-view/" itemprop="url">
                  我的第一个自定义View
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-07-13T12:35:05+08:00" content="2016-07-13">
              2016-07-13
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/07/13/my-first-custom-view/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/13/my-first-custom-view/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>直接上代码，做个学习笔记好了。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by Jimbray  .</span><br><span class="line"> * on 2016/7/12</span><br><span class="line"> * Email: jimbray16@gmail.com</span><br><span class="line"> * Description: 这是我第一个真正意义上的自定义View</span><br><span class="line"> */</span><br><span class="line">public class MyFirstProgressbar extends View &#123;</span><br><span class="line"></span><br><span class="line">    //max progress 虽然注释写了，但是还是不解释</span><br><span class="line">    private int mMaxProgress = 100;</span><br><span class="line"></span><br><span class="line">    // current progress</span><br><span class="line">    private int mCurrentProgress;</span><br><span class="line"></span><br><span class="line">    //progress bar 背景颜色</span><br><span class="line">    private int mBackgroundColor;</span><br><span class="line"></span><br><span class="line">    //progress bar 进度条颜色</span><br><span class="line">    private int mProgressColor;</span><br><span class="line"></span><br><span class="line">    //progress bar 进度条高度</span><br><span class="line">    private float mProgressBarheight;</span><br><span class="line"></span><br><span class="line">    //progress bar 背景高度</span><br><span class="line">    private float mBackgroundHeight;</span><br><span class="line"></span><br><span class="line">    //设置默认值</span><br><span class="line">    //默认progress bar 背景颜色</span><br><span class="line">    private final int default_background_color = Color.rgb(204, 204, 204);</span><br><span class="line">    //默认progress bar 进度条颜色</span><br><span class="line">    private final int default_progressbar_color = Color.rgb(66, 145, 241);</span><br><span class="line">    //默认 pregress bar 背景高度</span><br><span class="line">    private float default_background_height;</span><br><span class="line">    //默认 porgress 进度条高度</span><br><span class="line">    private float default_progressbar_height;</span><br><span class="line">    //默认progress bar 背景宽度（最小宽度）</span><br><span class="line">    private final float default_background_width = dp2px(45.f);</span><br><span class="line"></span><br><span class="line">    //画笔</span><br><span class="line">    private Paint mBackgroundPaint, mProgressbarPaint;</span><br><span class="line"></span><br><span class="line">    //progress 需要draw 的矩形区域</span><br><span class="line">    private RectF mBackgroundRectF = new RectF(0, 0, 0, 0);</span><br><span class="line">    private RectF mProgressbarRectF = new RectF(0, 0, 0, 0);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public MyFirstProgressbar(Context context) &#123;</span><br><span class="line">        super(context);</span><br><span class="line">        init(context, null, 0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public MyFirstProgressbar(Context context, AttributeSet attrs) &#123;</span><br><span class="line">        super(context, attrs);</span><br><span class="line">        init(context, attrs, 0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public MyFirstProgressbar(Context context, AttributeSet attrs, int defStyleAttr) &#123;</span><br><span class="line">        super(context, attrs, defStyleAttr);</span><br><span class="line">        init(context, attrs, defStyleAttr);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void init(Context context, AttributeSet attrs, int defStyleAttr) &#123;</span><br><span class="line">        default_background_height = dp2px(1.0f);</span><br><span class="line">        default_progressbar_height = dp2px(1.5f);</span><br><span class="line">        //progress bar 背景高度 比 progress bar 进度条高度 矮啊</span><br><span class="line"></span><br><span class="line">        //都是用默认值，没有把这些数值抛出去做属性</span><br><span class="line">        mBackgroundHeight = default_background_height;</span><br><span class="line">        mProgressBarheight = default_progressbar_height;</span><br><span class="line"></span><br><span class="line">        mBackgroundColor = default_background_color;</span><br><span class="line">        mProgressColor = default_progressbar_color;</span><br><span class="line"></span><br><span class="line">        initPainters();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 初始化 画笔 Paint</span><br><span class="line">     */</span><br><span class="line">    private void initPainters() &#123;</span><br><span class="line">        mBackgroundPaint = new Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        mBackgroundPaint.setColor(mBackgroundColor);</span><br><span class="line"></span><br><span class="line">        mProgressbarPaint = new Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        mProgressbarPaint.setColor(mProgressColor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 重载 函数</span><br><span class="line">     * @return view 的推荐最小宽度</span><br><span class="line">     * 修改为 progress bar 背景的默认高度</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    protected int getSuggestedMinimumWidth() &#123;</span><br><span class="line">        return (int) default_background_width;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 重载 函数</span><br><span class="line">     * @return view 的推荐最小高度</span><br><span class="line">     * 修改为 progress bar 的默认高度 （娶个最高的吧，不然高的那个头被截掉了就不好了）</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    protected int getSuggestedMinimumHeight() &#123;</span><br><span class="line">        return Math.max((int) mBackgroundHeight, (int) mProgressBarheight);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 这个函数的 解析 Google 一大把，就不解释了</span><br><span class="line">     * @param widthMeasureSpec</span><br><span class="line">     * @param heightMeasureSpec</span><br><span class="line">     * 现在这里是个套路活，跟着老司机走就行了</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;</span><br><span class="line">        setMeasuredDimension(measure(widthMeasureSpec, true), measure(heightMeasureSpec, false));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 测量 view 的 宽高信息</span><br><span class="line">     * @param measureSpec</span><br><span class="line">     * @param isWidth</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    private int measure(int measureSpec, boolean isWidth) &#123;</span><br><span class="line">        int result;</span><br><span class="line">        int mode = MeasureSpec.getMode(measureSpec);</span><br><span class="line">        int size = MeasureSpec.getSize(measureSpec);</span><br><span class="line">        //不要忘记 padding ，万一有人设置了呢</span><br><span class="line">        int padding = isWidth ? getPaddingLeft() + getPaddingRight() : getPaddingTop() + getPaddingBottom();</span><br><span class="line">        if (mode == MeasureSpec.EXACTLY) &#123; //如果 width 或者 height 都设置了 精确值：比如 45dp啊什么的</span><br><span class="line">            result = size; //就按主人的来吧，诶，森么是主人</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            //其他情况，既然你都不知道要什么，就按我的套路来吧</span><br><span class="line">            result = isWidth ? getSuggestedMinimumWidth() : getSuggestedMinimumHeight();</span><br><span class="line">            result += padding; //padding 这个小伙子还是很调皮的</span><br><span class="line">            if (mode == MeasureSpec.AT_MOST) &#123;</span><br><span class="line">                if (isWidth) &#123;</span><br><span class="line">                    result = Math.max(result, size);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    result = Math.min(result, size);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /** 要开车了，快上车！</span><br><span class="line">     * @param canvas</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    protected synchronized void onDraw(Canvas canvas) &#123;</span><br><span class="line">        calRectF();</span><br><span class="line"></span><br><span class="line">        canvas.drawRect(mBackgroundRectF, mBackgroundPaint);</span><br><span class="line"></span><br><span class="line">        canvas.drawRect(mProgressbarRectF, mProgressbarPaint);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 精华就在这里了。</span><br><span class="line">     * 一开始我也看不懂</span><br><span class="line">     * 现在我也看不懂</span><br><span class="line">     * 可是效果出来了</span><br><span class="line">     * 就这么滴吧</span><br><span class="line">     * 多看几次</span><br><span class="line">     * 说不定就懂了呢</span><br><span class="line">     */</span><br><span class="line">    private void calRectF() &#123;</span><br><span class="line">        mProgressbarRectF.left = getPaddingLeft();</span><br><span class="line">        mProgressbarRectF.top = getHeight() / 2.0f - mProgressBarheight / 2.0f;</span><br><span class="line">        mProgressbarRectF.right = (getWidth() - getPaddingLeft() - getPaddingRight()) / (getMax() * 1.0f) * getProgress() + getPaddingLeft();</span><br><span class="line">        mProgressbarRectF.bottom = getHeight() / 2.0f + mProgressBarheight / 2.0f ;</span><br><span class="line"></span><br><span class="line">        mBackgroundRectF.left = mProgressbarRectF.right;</span><br><span class="line">        mBackgroundRectF.top = getHeight() / 2.0f - mBackgroundHeight / 2.0f;</span><br><span class="line">        mBackgroundRectF.right = getWidth() - getPaddingRight();</span><br><span class="line">        mBackgroundRectF.bottom = getHeight() / 2.0f + mBackgroundHeight / 2.0f;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /** 这个我也不想说</span><br><span class="line">     * 如果三个月之后我看不懂这个代码</span><br><span class="line">     * 说明</span><br><span class="line">     * 我应该是失忆了</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public int getProgress() &#123;</span><br><span class="line">        return mCurrentProgress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 同上</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public int getMax() &#123;</span><br><span class="line">        return mMaxProgress;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 同上</span><br><span class="line">     * @param progress</span><br><span class="line">     */</span><br><span class="line">    public void setProgress(int progress) &#123;</span><br><span class="line">        mCurrentProgress = progress;</span><br><span class="line">        invalidate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 让我的 progress 动起来！</span><br><span class="line">     * ValueAnimator 是个神器</span><br><span class="line">     * Google一下</span><br><span class="line">     * @param progress</span><br><span class="line">     */</span><br><span class="line">    public void anitProgress(int progress) &#123;</span><br><span class="line">        ValueAnimator animator = ValueAnimator.ofInt(0, progress);</span><br><span class="line">        animator.setDuration(1500);</span><br><span class="line">        animator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onAnimationUpdate(ValueAnimator animation) &#123;</span><br><span class="line">                mCurrentProgress = (int) animation.getAnimatedValue();</span><br><span class="line">                postInvalidate();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        animator.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public float dp2px(float dp) &#123;</span><br><span class="line">        final float scale = getResources().getDisplayMetrics().density;</span><br><span class="line">        return dp * scale + 0.5f;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>这就是我第一个实质意义上的自定义View了，以前一般都是扩展TextView啊，组合LinearLayout<br>之类的。<br>虽然这个View也是看着别人的代码写的。<br>不过总算是自己动手敲出来了。<br>敲开心啊。<br>我 <del>照抄</del>学习的 project <a href="https://github.com/daimajia" target="_blank" rel="external">代码家</a>的<a href="https://github.com/daimajia/NumberProgressBar" target="_blank" rel="external">NumberProgressBar</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/19/python-to-qiniu2/" itemprop="url">
                  简化markdown写作中的贴图流程（windows基本版）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-19T21:12:36+08:00" content="2016-06-19">
              2016-06-19
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/19/python-to-qiniu2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/19/python-to-qiniu2/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>接上一篇文章 <a href="http://jimbray.xyz/2016/06/14/python-to-qiniu/">简化markdown写作中的贴图流程（windows简陋版）</a></p>
<p>上一篇文章是 做了很久，除了对python不熟，还有懒，所以最终的结果不尽人意，可以说做出来一个半成品。能用，但用起来不爽。<br>所以，现在完成了基本版，基本版基本可用了</p>
<p>上次的版本是 获取 全屏截图，这样的话像QQ截图这些功能都用不上了，而且还是显示很多不必要的元素在截图里面，比如说下面这个图啊<br><img src="http://7xv11f.com1.z0.glb.clouddn.com/img_1466342265.26.jpg" alt="img_1466342265.26.jpg"><br>箭头所指的地方，根本不应该出现在截图里面的，是多余的元素。<br>废话不多说，开干。<br>思路跟实现跟上次一点区别都没有<br>代码也只是修改了一个函数，其他的基本没有变化<br>主要记录遇到的几个问题</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><p>先把代码贴出来，再上问题<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_clipboard_image</span><span class="params">()</span>:</span></span><br><span class="line">    im = ImageGrab.grabclipboard()</span><br><span class="line">    <span class="keyword">if</span> im <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        print(<span class="string">'Error: No image data in clipboard'</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> isinstance(im, Image.Image):</span><br><span class="line">        <span class="keyword">print</span> im.format, im.size, im.mode</span><br><span class="line">        width, height = im.size</span><br><span class="line">        saved_path = <span class="string">"img_"</span> + str(time.time()) + <span class="string">".jpg"</span></span><br><span class="line">        <span class="comment"># im.resize((30, 30), Image.ANTIALIAS).load()</span></span><br><span class="line">        im.save(saved_path)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">print</span> saved_path</span><br><span class="line">        <span class="keyword">return</span> saved_path</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'the object in clipboard is not a image.'</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">None</span></span><br></pre></td></tr></table></figure></p>
<p>这个函数是修改的，之前是获取全屏截图，现在修改为获取剪贴板中的图片</p>
<h4 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h4><h5 id="问题1"><a href="#问题1" class="headerlink" title="问题1"></a>问题1</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Unsupported BMP bitfields layout</span><br></pre></td></tr></table></figure>
<p>这个是 Pillow 的bug，搜索到解决办法：<br>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/06/19/python-to-qiniu2/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/14/python-to-qiniu/" itemprop="url">
                  简化markdown写作中的贴图流程（windows简陋版）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-14T23:59:54+08:00" content="2016-06-14">
              2016-06-14
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/14/python-to-qiniu/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/14/python-to-qiniu/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>上次在网上闲逛的时候看到一篇文章</p>
<p><a href="http://www.jianshu.com/p/7bd4e6ed99be/comments/1794317#comment-1794317">简化markdown写作中的贴图流程</a></p>
<p>刚好最近也在学习python，看起来好有趣啊，这篇文章讲的是Mac上的，<br>我没有Mac，只有Windows，文章里面也写了Windows系统的实现思路，既然作者已经给出来了，作为一个python初学者，动动手罢</p>
<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><ol>
<li>截图（保存在剪贴板中）</li>
<li>使用七牛sdk 上传剪切板中的图片</li>
<li>获取返回的url，并合成 markdown 贴图语法<br>应该就可以了吧</li>
</ol>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><ol>
<li>安装 七牛python sdk,我用的是IDE pycharm 方式<br><img src="http://7xv11f.com1.z0.glb.clouddn.com/img_1465917613.88.jpg" alt="img_1465917613.88.jpg"></li>
<li>下载安装 <a href="https://autohotkey.com/download/">AutoHotKey</a> 软件</li>
<li>写 python代码</li>
<li>写AutoHotKey脚本</li>
</ol>
<h4 id="开始动手"><a href="#开始动手" class="headerlink" title="开始动手"></a>开始动手</h4><p>写代码<br>由于技术太渣，搜到又看不懂win32什么的，最后获取剪贴板截图的功能没能写出来，找到了另一个库 PIL<br>这个库的截图也是在剪切板的，不过不是其他软件接下来的，是系统截下来的 screencapture </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">AK = <span class="string">'access_key'</span></span><br><span class="line">SK = <span class="string">'secret_key'</span></span><br><span class="line">bucket_name = <span class="string">"bucket_name"</span></span><br><span class="line">buckey_url = &#123;</span><br><span class="line">    <span class="string">'bucket_name'</span>: <span class="string">'domain_name'</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面是一些初始化工作<br>都是七牛的东西<br>可以在 七牛的 开发者帐号里面找到<br>access_key 和 secret_key 就不说了<br>bucket_name 是 空间名称<br>domain_name 是 空间域名</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/06/14/python-to-qiniu/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/10/facebook-share-not-callback/" itemprop="url">
                  Facebook ShareDialog 没有回调的问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-10T20:24:04+08:00" content="2016-06-10">
              2016-06-10
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/10/facebook-share-not-callback/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/10/facebook-share-not-callback/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>完成 facebook 分享功能之后，如果手机安装了Facebook，分享之后会有成功或者失败的 反馈</p>
<p>但是如果没有安装，就会使用 WEB 版本的 进行分享，这个时候，分享完了就是完了，不知道是成功还是失败。</p>
<p>去看了下文档，Facebook提供这个回调。</p>
<p>叫做 CallbakManager ，既然找到了，就上手吧</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ShareDialog shareDialog = <span class="keyword">new</span> ShareDialog(act);</span><br><span class="line"></span><br><span class="line">CallbackManager callbackManager = CallbackManager.Factory.create();</span><br><span class="line">shareDialog.registerCallback(callbackManager, <span class="keyword">new</span> FacebookCallback&lt;Sharer.Result&gt;() &#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(Sharer.Result result)</span> </span>&#123;</span><br><span class="line">		Log.d(<span class="string">"tag"</span>, <span class="string">"OnSuccess"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCancel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		Log.d(<span class="string">"tag"</span>, <span class="string">"onCancel"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(FacebookException error)</span> </span>&#123;</span><br><span class="line">		Log.d(<span class="string">"tag"</span>, <span class="string">"onError"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">ShareLinkContent content = <span class="keyword">new</span> ShareLinkContent.Builder()</span><br><span class="line">		.setContentUrl(Uri.parse(<span class="string">"http://url.com"</span>))</span><br><span class="line">		.setImageUrl(Uri.parse(<span class="string">"http://url.com"</span>))</span><br><span class="line">		.setContentTitle(<span class="string">"Title"</span>)</span><br><span class="line">		.setContentDescription(<span class="string">"description"</span>)</span><br><span class="line">		.build();</span><br><span class="line"></span><br><span class="line">shareDialog.show(content, ShareDialog.Mode.AUTOMATIC);</span><br></pre></td></tr></table></figure>
<p>看上去就是这样的，可是每次都没有回调<br>最后去Facebook 文档又看了一遍，找到解决办法了，原来之前没有看清楚</p>
<p>Facebook share封装起来之后是用 Activity 做回调的<br>所以 纯粹的使用 CallbackManager 肯定不会生效啦。</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/06/10/facebook-share-not-callback/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/09/try-docker/" itemprop="url">
                  试玩 Docker
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-09T17:52:32+08:00" content="2016-06-09">
              2016-06-09
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/09/try-docker/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/09/try-docker/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h3><p>docker这么火，体验一下，感受一下</p>
<h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><p>Linux系统主机一台(我用的的ubuntu)<br>docker文档看一下，我找了好几个，都挺不错的，就是不动一下手，总感觉虚</p>
<h2 id="开动"><a href="#开动" class="headerlink" title="开动"></a>开动</h2><h4 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h4><p>我用的是ubuntu14.04<br>两种方式<br>1.源已经内置docker，不过教程裡有说那个docker没有更新<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt-get install docker</span><br></pre></td></tr></table></figure></p>
<p>反正我没用<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl <span class="_">-s</span>SL https://get.docker.com/ubuntu/ | sudo sh</span><br></pre></td></tr></table></figure></p>
<p>可能需要代理</p>
<p>像这个样子就是安装成功了</p>
<p>docker 最主要的就是container和image了<br>那就弄个image吧<br>从哪弄？直接pull就可以了<br>那pull什么呢，总要知道个地址的</p>
<p>先搜一下<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker search nginx</span><br></pre></td></tr></table></figure></p>
<p>就用第一个吧</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker pull nginx </span><br><span class="line"></span><br><span class="line">docker images</span><br><span class="line"></span><br><span class="line">docker run nginx</span><br><span class="line"></span><br><span class="line">docker run -i nginx</span><br><span class="line"></span><br><span class="line">docker run -t nginx</span><br><span class="line"></span><br><span class="line">docker run -it nginx</span><br><span class="line"></span><br><span class="line">docker run <span class="_">-d</span> nginx</span><br><span class="line"></span><br><span class="line">docker run -- name nginx-test <span class="_">-d</span> nginx</span><br><span class="line"></span><br><span class="line">docker run --name nginx -test <span class="_">-d</span> -p 8080:80 nginx</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/09/linode-install-lnmp/" itemprop="url">
                  Linode 安装 lnmp 学习
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-09T17:30:04+08:00" content="2016-06-09">
              2016-06-09
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/09/linode-install-lnmp/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/09/linode-install-lnmp/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>1.安装 LNMP 参见 <a href="http://lnmp.org/install.html">lnmp官网</a></p>
<p>2.安装完成之后 查看 nginx  、 php、mysql 的运行状态</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">ps aux | grep nginx</span><br><span class="line"></span><br><span class="line">ps aux | grep php</span><br><span class="line"></span><br><span class="line">ps aux | gerp mysql</span><br></pre></td></tr></table></figure>
<p>确保已经在运行状态</p>
<p>3.查看 nginx 的配置文件 （nginx.conf）路径可以</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">whereis nginx</span><br></pre></td></tr></table></figure>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>命令查看</p>
<p>配置文件内 user：www-data</p>
<p>www-data 可任意修改</p>
<p>4.修改 php 的配置文件 （php/etc/php-fpm.conf）</p>
<p>修改<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">listen.owner = www-data</span><br><span class="line">listen.group = www-data</span><br></pre></td></tr></table></figure></p>
<p>www-data 修改为 第3步 nginx 设置的对应的User名称</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/06/09/linode-install-lnmp/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/09/ssh-root-login-setting/" itemprop="url">
                  VPS 禁止远程ROOT登录
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-09T12:48:17+08:00" content="2016-06-09">
              2016-06-09
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/09/ssh-root-login-setting/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/09/ssh-root-login-setting/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="编辑ssh-配置文件"><a href="#编辑ssh-配置文件" class="headerlink" title="编辑ssh 配置文件"></a>编辑ssh 配置文件</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vi /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure>
<h3 id="修改关键配置"><a href="#修改关键配置" class="headerlink" title="修改关键配置"></a>修改关键配置</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">PermitRootLogin no</span><br></pre></td></tr></table></figure>
<h3 id="重启-ssh-服务"><a href="#重启-ssh-服务" class="headerlink" title="重启 ssh 服务"></a>重启 ssh 服务</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">service /etc/init.d/ssh restart</span><br></pre></td></tr></table></figure>
<p>Done.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/09/falsk-root/" itemprop="url">
                  Flask 直接显示根目录文件内容
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-09T12:37:25+08:00" content="2016-06-09">
              2016-06-09
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/09/falsk-root/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/09/falsk-root/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="搜索结果"><a href="#搜索结果" class="headerlink" title="搜索结果"></a>搜索结果</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@app.route('/&lt;path&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">info</span><span class="params">(path)</span>:</span></span><br><span class="line">    resp = make_response(open(path).read())</span><br><span class="line">    resp.headers[<span class="string">"Content-type"</span>]=<span class="string">"application/json;charset=UTF-8"</span></span><br><span class="line">    <span class="keyword">return</span> resp</span><br></pre></td></tr></table></figure>
<p>按道理应该是可以生效的，但我在用的时候却报错了</p>
<h3 id="出现错误"><a href="#出现错误" class="headerlink" title="出现错误"></a>出现错误</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">IOError: [Errno 2] No such file or directory: u<span class="string">'readme.json'</span></span><br></pre></td></tr></table></figure>
<p>居然找不到这个文件</p>
<h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><p>使用绝对路径</p>
<pre><code class="python"><span class="meta">@app.route('/&lt;path&gt;')</span>
<span class="function"><span class="keyword">def</span> <span class="title">today</span><span class="params">(path)</span>:</span>
    base_dir = os.path.dirname(__file__)
    resp = make_response(open(os.path.join(base_dir, path)).read())
    resp.headers[<span class="string">"Content-type"</span>]=<span class="string">"application/json;charset=UTF-8"</span>
    <span class="keyword">return</span> resp
</code></pre>
<p>访问 127.0.0.1:5000/readme.json</p>
<p>Done.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/09/ss-thunder/" itemprop="url">
                  使用迅雷下载后 shadowsocks失效 解决办法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-09T12:08:50+08:00" content="2016-06-09">
              2016-06-09
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/09/ss-thunder/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/09/ss-thunder/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天用的好好的 ss 突然之间失效了，看了下日志：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">failed to recv data <span class="keyword">in</span> handshakeReceive2Callback</span><br></pre></td></tr></table></figure>
<p>网上搜罗下，出现这个情况的不在少数，主要是因为使用了迅雷下载导致</p>
<h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><p>1.在服务中找到XLServicePlatform把这个服务禁用了。现在应该可以使用ss了</p>
<p>2.重启电脑后发现，ss又不能用了，继续查看服务，XLServicePlatform又起来了，还把启动方式变成了自动。</p>
<p>3.关掉 服务，打开 C:\Program Files\Common Files\Thunder Network\ServicePlatform\XLSP.dll ，把里面的内容清空</p>
<p>问题解决。</p>
<p>XLServicePlatform：这个服务主要的功能是迅雷的网络诊断，并不是迅雷下载的基础服务，应该不会影响迅雷的下载使用</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/04/sync-hexo-source/" itemprop="url">
                  在同一个repo备份hexo文章以及配置
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-04T16:48:27+08:00" content="2016-06-04">
              2016-06-04
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/04/sync-hexo-source/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/04/sync-hexo-source/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><p>使用 Hexo 的一键发布文章很方便，但是有多个地点需要同步文章的时候就麻烦了。<br>因为GitHub 的 repo 上 只有Hexo 编译好的 html文件，<br>并没有Hexo 的source 文件（也就是文章）。<br>如果需要在不同地点进行 文章发布的话，就没有办法完成了（先不考虑草稿的事）<br>所以 我们需要在其他 repo 进行文章的备份。</p>
<h3 id="使用工具"><a href="#使用工具" class="headerlink" title="使用工具"></a>使用工具</h3><p>还是使用Git 进行操作<br>Git 需要一个服务器<br>现在支持 git 托管的服务已经很多了，用其他的也可以。<br>不过我不想注册使用那么多，还是使用Github 吧<br>而且还是同一个 repo</p>
<h3 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h3><h4 id="上传操作"><a href="#上传操作" class="headerlink" title="上传操作"></a>上传操作</h4><p>进入 Hexo 所在的文件夹<br>打开 git bash 窗口</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure>
<p>进行初始化repo</p>
<p>完成之后，添加 修改的文件，本来 Hexo 就自带了 .gitignore 文件<br>需要忽略的文件 都已经默认配置好了<br>接下来进行第一次 提交。<br>当然了，git流程还是要走正确的<br>首先应该是 add</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git add .</span><br></pre></td></tr></table></figure>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/06/04/sync-hexo-source/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/03/hello-world/" itemprop="url">
                  Hello World
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-03T16:48:27+08:00" content="2016-06-03">
              2016-06-03
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/03/hello-world/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/03/hello-world/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>参照 <a href="https://xuanwo.org/2015/03/26/hexo-intor/">史上最详细的Hexo博客搭建图文教程</a> 搭建了自己的 Blog，向来不会写东西。</p>
<p>作为一个技术工作者，工作学习过程中总会有一些经验总结，我又比较健忘，基本上学什么忘什么，还是找个地方做下笔记做个记录好了。</p>
<p>毕竟，好记性不如烂笔头。还是很有道理的。</p>
<p>搭建完成了，感觉发布过程还是很方便的。没有繁琐的过程，专注自己的记录就可以了。</p>
<p>这几年 尝试过了无数的 Blog 程序。现成的，自己搭建的，各种各样的博客都玩过，就是没有写过。<br>坚持是一件很难的事情。</p>
<p>Done.<br>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/06/03/hello-world/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://7xv11f.com1.z0.glb.clouddn.com/V.jpg"
               alt="jimbray" />
          <p class="site-author-name" itemprop="name">jimbray</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">14</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jimbray</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"jimbray"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  
  

  

  

</body>
</html>
