<!DOCTYPE html>
<html lang="en-us">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">

<meta name="description" content="上次在网上闲逛的时候看到一篇文章
简化markdown写作中的贴图流程
刚好最近也在学习python，看起来好有趣啊，这篇文章讲的是Mac上的， 我没有Mac，只有Windows，文章里面也写了Windows系统的实现思路，既然作者已经给出来了，作为一个python初学者，动动手罢
思路  截图（保存在剪贴板中） 使用七牛sdk 上传剪切板中的图片 获取返回的url，并合成 markdown 贴图语法 应该就可以了吧  实现 准备工作  安装 七牛python sdk,我用的是IDE pycharm 方式  下载安装 AutoHotKey 软件 写 python代码 写AutoHotKey脚本  开始动手 写代码 由于技术太渣，搜到又看不懂win32什么的，最后获取剪贴板截图的功能没能写出来，找到了另一个库 PIL 这个库的截图也是在剪切板的，不过不是其他软件接下来的，是系统截下来的 screencapture
AK = &#39;access_key&#39; SK = &#39;secret_key&#39; bucket_name = &quot;bucket_name&quot; buckey_url = { &#39;bucket_name&#39;: &#39;domain_name&#39;, }  上面是一些初始化工作 都是七牛的东西 可以在 七牛的 开发者帐号里面找到 access_key 和 secret_key 就不说了 bucket_name 是 空间名称 domain_name 是 空间域名
继续:获取图片
def save_clipboard_image(): pic = ImageGrab.">

<meta property="og:title" content="简化markdown写作中的贴图流程（windows简陋版）" />
<meta property="og:description" content="上次在网上闲逛的时候看到一篇文章
简化markdown写作中的贴图流程
刚好最近也在学习python，看起来好有趣啊，这篇文章讲的是Mac上的， 我没有Mac，只有Windows，文章里面也写了Windows系统的实现思路，既然作者已经给出来了，作为一个python初学者，动动手罢
思路  截图（保存在剪贴板中） 使用七牛sdk 上传剪切板中的图片 获取返回的url，并合成 markdown 贴图语法 应该就可以了吧  实现 准备工作  安装 七牛python sdk,我用的是IDE pycharm 方式  下载安装 AutoHotKey 软件 写 python代码 写AutoHotKey脚本  开始动手 写代码 由于技术太渣，搜到又看不懂win32什么的，最后获取剪贴板截图的功能没能写出来，找到了另一个库 PIL 这个库的截图也是在剪切板的，不过不是其他软件接下来的，是系统截下来的 screencapture
AK = &#39;access_key&#39; SK = &#39;secret_key&#39; bucket_name = &quot;bucket_name&quot; buckey_url = { &#39;bucket_name&#39;: &#39;domain_name&#39;, }  上面是一些初始化工作 都是七牛的东西 可以在 七牛的 开发者帐号里面找到 access_key 和 secret_key 就不说了 bucket_name 是 空间名称 domain_name 是 空间域名
继续:获取图片
def save_clipboard_image(): pic = ImageGrab." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/python-to-qiniu/" />



<meta property="article:published_time" content="2016-06-14T23:59:54&#43;00:00"/>
<meta property="article:modified_time" content="2016-06-14T23:59:54&#43;00:00"/>












<title>


     简化markdown写作中的贴图流程（windows简陋版） 

</title>
<link rel="canonical" href="http://example.org/python-to-qiniu/">










<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700|Ubuntu+Mono:400,400i,700,700i|Raleway:500">



    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/pygments.css">
    <link rel="stylesheet" href="/css/main.css">
    




<link rel="shortcut icon"

    href="/img/favicon.ico"

>








</head>


<body lang="">

<section class="header">
    <div class="container">
        <div class="content">
            
            <a href="/"><div class="name"></div></a>
            
            <nav>
                <ul>
                    
                </ul>
            </nav>
        </div>
    </div>
</section>

<section class="icons">
    <div class="container">
        <div class="content">

        

        

        

        

        

        

        
            
        

        

        

        
            <a href="http://example.org/index.xml"><img class="icon" src="/img/rss.svg" alt="rss" /></a>
        
        
        </div>
    </div>
</section>

<section class="main">
    <div class="container">
        <div class="content">
            <div class="page-heading">

    简化markdown写作中的贴图流程（windows简陋版）

</div>

            <div class="markdown">
                

<p>上次在网上闲逛的时候看到一篇文章</p>

<p><a href="http://www.jianshu.com/p/7bd4e6ed99be/comments/1794317#comment-1794317">简化markdown写作中的贴图流程</a></p>

<p>刚好最近也在学习python，看起来好有趣啊，这篇文章讲的是Mac上的，
我没有Mac，只有Windows，文章里面也写了Windows系统的实现思路，既然作者已经给出来了，作为一个python初学者，动动手罢</p>

<h3 id="思路">思路</h3>

<ol>
<li>截图（保存在剪贴板中）</li>
<li>使用七牛sdk 上传剪切板中的图片</li>
<li>获取返回的url，并合成 markdown 贴图语法
应该就可以了吧</li>
</ol>

<h3 id="实现">实现</h3>

<h4 id="准备工作">准备工作</h4>

<ol>
<li>安装 七牛python sdk,我用的是IDE pycharm 方式
<img src="http://7xv11f.com1.z0.glb.clouddn.com/img_1465917613.88.jpg" alt="img_1465917613.88.jpg" /></li>
<li>下载安装 <a href="https://autohotkey.com/download/">AutoHotKey</a> 软件</li>
<li>写 python代码</li>
<li>写AutoHotKey脚本</li>
</ol>

<h4 id="开始动手">开始动手</h4>

<p>写代码
由于技术太渣，搜到又看不懂win32什么的，最后获取剪贴板截图的功能没能写出来，找到了另一个库 PIL
这个库的截图也是在剪切板的，不过不是其他软件接下来的，是系统截下来的 screencapture</p>

<pre><code class="language-python">AK = 'access_key'
SK = 'secret_key'
bucket_name = &quot;bucket_name&quot;
buckey_url = {
    'bucket_name': 'domain_name',
}
</code></pre>

<p>上面是一些初始化工作
都是七牛的东西
可以在 七牛的 开发者帐号里面找到
access_key 和 secret_key 就不说了
bucket_name 是 空间名称
domain_name 是 空间域名</p>

<!-- more -->

<p>继续:获取图片</p>

<pre><code class="language-python">def save_clipboard_image():
    pic = ImageGrab.grab()
    saved_path = &quot;img_&quot; + str(time.time()) + &quot;.jpg&quot;;
    pic.save(saved_path)
    return saved_path
</code></pre>

<p>获取系统截图，然后保存在一个文件名为当前时间的jpg文件中
返回保存的文件路径</p>

<p>继续：上传图片</p>

<pre><code class="language-python">class Qiniu():
    def __init__(self, ak, sk):
        self.access_key = ak
        self.secret_key = sk
        self._q = qiniu.Auth(self.access_key, self.secret_key)

    def upload_file(self, bucket_name, key, file_path):
        #生成上传 Token，可以指定过期时间等
        token = self._q.upload_token(bucket_name, key, 3600)
        ret, info = put_file(token, key, file_path)
        print(info)
        pic_url = self.get_pic_url(bucket_name, file_path)
        add_to_clipboard(pic_url, file_path)

    def get_pic_url(self, bucket_name, file_path):
        result = buckey_url[bucket_name] + file_path
        return result
</code></pre>

<p>上传图片的 功能都是 七牛sdk 提供的，sdk demo里面都有，也没什么好说的了
上面有个 add_to_clipboard 方法</p>

<pre><code class="language-python">def add_to_clipboard(pic_url, file_name):
    txt = '![' + file_name +']('+ pic_url +')'
    print(txt)
    command = 'echo ' + txt.strip() + '| clip'
    os.system(command)
</code></pre>

<p>工作就是把上传完成之后的图片路径 转换成 markdown 语法，并复制到剪贴板
还剩一个入口函数</p>

<pre><code class="language-python">if __name__ == '__main__':
    saved_path = save_clipboard_image()
    q = Qiniu(AK, SK)
    q.upload_file(bucket_name, saved_path, saved_path)
</code></pre>

<p>需要导入的库</p>

<pre><code class="language-python">from PIL import ImageGrab
import time
from qiniu import Auth, put_file
import os
</code></pre>

<p>好像就写完了
运行以下，去七牛空间上看，就会多一张图片，以一串数字命名
然后新建一个 txt 文档，ctrl-v 以下，就能看到一个字符串啦，是在markdown插入图片的语法</p>

<p>继续：设置触发
接下来要上场的是 windows 下的 神器 AutoHotKey，我也是看前面那个文章才知道的
工作主要是 触发这个python文件的执行
那我就偷懒了一下
使用 ctrl+alt+v触发python</p>

<pre><code class="language-ahk">^!v::
run,%comspec% /c python D:\python\upload.py
</code></pre>

<p>^代表ctrl键
!代码alt键
v代表v键（废话）
工作就是按键之后，执行 cmd 然后输入命令
python D:\python\upload.py
运行起来
执行一下，上传成功，可是每张图片都被 cmd 那个黑框框挡住了
google了以下
答案是</p>

<pre><code class="language-ahk">run,%comspec% /c python D:\python\upload.py ,, hide
</code></pre>

<p>后面加上一个 hide
就不会出现黑框框了。
到这里应该就是把这个功能的简陋版弄出来了
等之后有时间了，学习更多了，在优化以下，减少硬编码</p>

<p>我的第一个 python 功能就这么完成了。
哈。
试试效果</p>

<p><img src="http://7xv11f.com1.z0.glb.clouddn.com/img_1465919301.23.jpg" alt="img_1465919301.23.jpg" /></p>

<p>快12点了
早睡早起身体好。</p>

            </div>
        </div>
    </div>
</section>








</body>
</html>

