<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Android," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="按照惯例，先上效果

涉及到的知识点
ViewGroup 的事件分发拦截机制

ViewDragHelper 的基本使用


ViewGroup 的事件分发拦截机制ViewGroup 有三个方法

dispatchTouchEvent
onInterceptTouchEvent
onTouchEvent

dispatchTouchEvent用于touch事件的分发；通俗点说，就是决定当前这个to">
<meta property="og:type" content="article">
<meta property="og:title" content="ScrollView 与 ViewDragHelper 的混合使用学习">
<meta property="og:url" content="http://jimbray.github.io/2017/01/06/suppriseBottomView/index.html">
<meta property="og:site_name" content="Jimbray">
<meta property="og:description" content="按照惯例，先上效果

涉及到的知识点
ViewGroup 的事件分发拦截机制

ViewDragHelper 的基本使用


ViewGroup 的事件分发拦截机制ViewGroup 有三个方法

dispatchTouchEvent
onInterceptTouchEvent
onTouchEvent

dispatchTouchEvent用于touch事件的分发；通俗点说，就是决定当前这个to">
<meta property="og:image" content="http://7xv11f.com1.z0.glb.clouddn.com/suppriseBottomView.gif">
<meta property="og:image" content="http://7xv11f.com1.z0.glb.clouddn.com/surpriseBottomView-unfinished-1.gif">
<meta property="og:image" content="http://7xv11f.com1.z0.glb.clouddn.com/surpriseBottomView-unfinished-1.gif">
<meta property="og:updated_time" content="2017-02-15T03:33:13.411Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ScrollView 与 ViewDragHelper 的混合使用学习">
<meta name="twitter:description" content="按照惯例，先上效果

涉及到的知识点
ViewGroup 的事件分发拦截机制

ViewDragHelper 的基本使用


ViewGroup 的事件分发拦截机制ViewGroup 有三个方法

dispatchTouchEvent
onInterceptTouchEvent
onTouchEvent

dispatchTouchEvent用于touch事件的分发；通俗点说，就是决定当前这个to">
<meta name="twitter:image" content="http://7xv11f.com1.z0.glb.clouddn.com/suppriseBottomView.gif">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> ScrollView 与 ViewDragHelper 的混合使用学习 | Jimbray </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-78813427-1', 'auto');
  ga('send', 'pageview');
</script>







  <div style="display: none;">
    <script src="http://s6.cnzz.com/stat.php?id=1259500890&web_id=1259500890" type="text/javascript"></script>
  </div>





  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Jimbray</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">What I am saying is a lie.</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-apps">
          <a href="/apps" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            应用
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                ScrollView 与 ViewDragHelper 的混合使用学习
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-01-06T20:20:02+08:00" content="2017-01-06">
              2017-01-06
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/01/06/suppriseBottomView/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/06/suppriseBottomView/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>按照惯例，先上效果</p>
<p><img src="http://7xv11f.com1.z0.glb.clouddn.com/suppriseBottomView.gif" alt=""></p>
<h3 id="涉及到的知识点"><a href="#涉及到的知识点" class="headerlink" title="涉及到的知识点"></a>涉及到的知识点</h3><ul>
<li><p><code>ViewGroup</code> 的事件分发拦截机制</p>
</li>
<li><p><code>ViewDragHelper</code> 的基本使用</p>
</li>
</ul>
<h4 id="ViewGroup-的事件分发拦截机制"><a href="#ViewGroup-的事件分发拦截机制" class="headerlink" title="ViewGroup 的事件分发拦截机制"></a><code>ViewGroup</code> 的事件分发拦截机制</h4><p><code>ViewGroup</code> 有三个方法</p>
<ol>
<li><code>dispatchTouchEvent</code></li>
<li><code>onInterceptTouchEvent</code></li>
<li><code>onTouchEvent</code></li>
</ol>
<h5 id="dispatchTouchEvent"><a href="#dispatchTouchEvent" class="headerlink" title="dispatchTouchEvent"></a>dispatchTouchEvent</h5><p>用于<code>touch</code>事件的分发；通俗点说，就是决定当前这个<code>touch</code>事件应该交给谁来处理（是当前<code>View</code>还是父<code>View</code>）</p>
<blockquote>
<p>当触摸事件发生时 <code>Activity</code> 的 <code>dispatchTouchEvent(MotionEvent ev)</code> 方法会从根元素依次往下传递直到最内层子元素或在中间某一元素中事件被拦截或者消费.</p>
<p>如果 <code>return true</code>，事件会分发给当前 <code>View</code> 并由 <code>dispatchTouchEvent</code> 方法进行消费，同时事件会停止向下传递；这样该<code>View</code>的<code>onTouchEvent</code>事件也不会得到响应.<br>如果<code>return false</code>，会将事件返回给父 <code>View</code> 的 <code>onTouchEvent</code> 进行消费。<br>如果 <code>return super.dispatchTouchEvent(ev)</code>，事件会分发给当前 <code>View</code> 的 <code>onInterceptTouchEvent</code> 方法去进行处理。</p>
</blockquote>
<h5 id="onInterceptTouchEvent"><a href="#onInterceptTouchEvent" class="headerlink" title="onInterceptTouchEvent"></a>onInterceptTouchEvent</h5><p>用于<code>touch</code>事件的拦截；通俗点说，就是决定刚刚 <code>dispatchTouchEvent</code> 抛给我的<code>touch</code>事件应该交给谁来处理（是当前<code>View</code>还是子<code>View</code>）<em>注意跟<code>dispatchTouchEvent</code>的区别</em></p>
<blockquote>
<p>如果 <code>return true</code>，则将事件进行拦截，并将拦截到的事件交由该 <code>View</code> 的 <code>onTouchEvent</code> 进行处理；<br>如果 <code>return false</code>，则将事件向子<code>View</code>传递，再由子<code>View</code>的 <code>dispatchTouchEvent</code>来对这个事件处理；<br>如果 <code>return super.onInterceptTouchEvent(ev)</code>，事件会被拦截，并将事件交由该 <code>View</code> 的 <code>onTouchEvent</code> 进行处理。</p>
</blockquote>
<h5 id="onTouchEvent"><a href="#onTouchEvent" class="headerlink" title="onTouchEvent"></a>onTouchEvent</h5><p>用于touch事件的处理；通俗点说，就是决定刚刚 onInterceptTouchEvent 抛给我的touch事件进行处理（<del>这锅实在没得甩了</del> 还可以甩给父类，科科）</p>
<blockquote>
<p>如果<code>return false</code>，那么这个事件会从该 <code>View</code> 向父<code>View</code>传递，父 <code>View</code> 的 <code>onTouchEvent</code> 来接收，而且如果父<code>View</code>也是<code>return false</code>，那事件也会向上传递由<code>onTouchEvent</code>接收处理.<br>如果<code>retrun true</code>， 则会接收并消费该事件。<br>如果<code>retrun super.onTouchEvent(ev)</code> 和返回 false 时相同。</p>
</blockquote>
<h4 id="ViewDragHelper-的基本使用"><a href="#ViewDragHelper-的基本使用" class="headerlink" title="ViewDragHelper 的基本使用"></a>ViewDragHelper 的基本使用</h4><ol>
<li>创建实例</li>
<li><code>Touch</code> 事件分发拦截的相关处理</li>
<li><code>ViewDragHelper callback</code> 的实现</li>
</ol>
<p><code>ViewDragHelper</code> 的出现就是为了减轻 开发者实现拖拽行为功能 的负担，所以很简单的几个方法就可以做出<del>很好的效果</del>比以前用<code>onTouchEvent</code>自己写得要死要活的效果还要好。</p>
<a id="more"></a>
<h5 id="创建实例"><a href="#创建实例" class="headerlink" title="创建实例"></a>创建实例</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">mDragViewHelper = ViewDragHelper.create(<span class="keyword">this</span>, <span class="number">1.0f</span>, mDragHelperCallback)</span><br></pre></td></tr></table></figure>
<h5 id="Touch-事件分发拦截的相关处理"><a href="#Touch-事件分发拦截的相关处理" class="headerlink" title="Touch 事件分发拦截的相关处理"></a><code>Touch</code> 事件分发拦截的相关处理</h5><p>既然出动了<code>ViewDragHelper</code>，所以，很多的触摸事件我们就要放手给TA去处理了。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line">* 事件分发</span><br><span class="line">* <span class="doctag">@param</span> ev</span><br><span class="line">* <span class="doctag">@return</span></span><br><span class="line">* 可以根据具体需求决定如何分发事件</span><br><span class="line">× 这里不做处理</span><br><span class="line">*/</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">    Log.w(<span class="string">"jimbray"</span>, <span class="string">"dispatchTouchEvent"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.dispatchTouchEvent(ev);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 事件拦截 </span><br><span class="line">* <span class="doctag">@param</span> ev</span><br><span class="line">* <span class="doctag">@return</span></span><br><span class="line">* 直接将所有的事件都交由 ViewDragHelper 去处理</span><br><span class="line">* 可以根据具体需求决定是否交付事件</span><br><span class="line">*/</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">    Log.w(<span class="string">"jimbray"</span>, <span class="string">"onInterceptTouchEvent"</span>);</span><br><span class="line">    <span class="keyword">return</span> mDragViewHelper.shouldInterceptTouchEvent(ev);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">* 事件消费</span><br><span class="line">* <span class="doctag">@param</span> event</span><br><span class="line">* <span class="doctag">@return</span></span><br><span class="line">* 直接将所有的事件都交由 ViewDragHelper 去处理</span><br><span class="line">* 可以根据具体需求决定是否交付事件</span><br><span class="line">* 交付事件后直接 return true，结束事件</span><br><span class="line">*/</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">    Log.w(<span class="string">"jimbray"</span>, <span class="string">"onTouchEvent"</span>);</span><br><span class="line">    mDragViewHelper.processTouchEvent(event);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="ViewDragHelper-callback-的实现"><a href="#ViewDragHelper-callback-的实现" class="headerlink" title="ViewDragHelper callback 的实现"></a><code>ViewDragHelper callback</code> 的实现</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> ViewDragHelper.Callback mDragHelperCallback = <span class="keyword">new</span> ViewDragHelper.Callback() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryCaptureView</span><span class="params">(View child, <span class="keyword">int</span> pointerId)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> child == mDragView;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">clampViewPositionVertical</span><span class="params">(View child, <span class="keyword">int</span> top, <span class="keyword">int</span> dy)</span> </span>&#123;</span><br><span class="line">          	<span class="keyword">int</span> topBound = -<span class="number">1</span> * bottomView.getMeasuredHeight();</span><br><span class="line">            <span class="keyword">int</span> bottomBound = getHeight() - mDragView.getMeasuredHeight();</span><br><span class="line">            <span class="keyword">return</span> Math.min(Math.max(top, topBound), bottomBound);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">clampViewPositionHorizontal</span><span class="params">(View child, <span class="keyword">int</span> left, <span class="keyword">int</span> dx)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> leftBound = mDragView.getLeft();</span><br><span class="line">            <span class="keyword">int</span> rightBound = mDragView.getRight() - mDragView.getWidth();</span><br><span class="line">            <span class="keyword">return</span> Math.min(Math.max(leftBound, left), rightBound);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onViewReleased</span><span class="params">(View releasedChild, <span class="keyword">float</span> xvel, <span class="keyword">float</span> yvel)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(releasedChild == mDragView) &#123;</span><br><span class="line">                mDragViewHelper.settleCapturedViewAt(mDragViewOri.x, mDragViewOri.y);</span><br><span class="line">                postInvalidate();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onViewPositionChanged</span><span class="params">(View changedView, <span class="keyword">int</span> left, <span class="keyword">int</span> top, <span class="keyword">int</span> dx, <span class="keyword">int</span> dy)</span> 		   </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(changedView == mDragView) &#123;</span><br><span class="line">                bottomView.layout(bottomView.getLeft(), </span><br><span class="line">                top + mDragView.getHeight(), </span><br><span class="line">                bottomView.getRight(), top+mDragView.getHeight() +              bottomView.getMeasuredHeight());</span><br><span class="line">            &#125;</span><br><span class="line">            postInvalidate();</span><br><span class="line">        &#125;</span><br><span class="line">  </span><br><span class="line">  		<span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getViewVerticalDragRange</span><span class="params">(View child)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> getMeasuredHeight() - child.getMeasuredHeight();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getViewHorizontalDragRange</span><span class="params">(View child)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> getMeasuredWidth() - child.getMeasuredWidth();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>
<p><code>ViewDragHelper.Callback</code> 有很多方法，这里只说明一下用到的好了。</p>
<ul>
<li><p>tryCaptureView</p>
<p>如果返回<code>ture</code>则表示可以捕获该<code>view</code>，你可以根据传入的第一个<code>view</code>参数(<code>child</code>) 决定哪些可以捕获</p>
</li>
<li><p>clampViewPositionVertical, clampViewPositionHorizontal</p>
<p>可以在该方法中对<code>child</code>移动的边界进行控制，<code>left</code> , <code>top</code> 分别为即将移动到的位置</p>
<p>比如我想要在横向方向进行限制，只让捕获的<code>View</code>从坐标系里的 100 移动到 400，可以这样写</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> leftBound = <span class="number">100</span>; <span class="comment">// 左边限定为 100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> rightBound = <span class="number">400</span> - mDragView.getWidth(); <span class="comment">// 右边限定为 400的位置，由于要使用 left 进行布局，											    // 所以需要减去mDragView的宽度</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> Math.min(Math.max(leftBound, left), rightBound);</span><br></pre></td></tr></table></figure>
</li>
<li><p>onViewReleased</p>
<p>当拖拽<code>View</code>的手指释放的时候回调，可以做回弹操作，或者其他需求</p>
</li>
<li><p>onViewPositionChanged</p>
<p>当拖拽的<code>View</code>位置变化的时候回调</p>
</li>
<li><p>getViewVerticalDragRange, getViewHorizontalDragRange</p>
<p>这俩是个坑，当<code>ViewGroup</code>内的子控件会消耗事件时（就是有点击或者其他事件时），你会发现<code>ViewDragHelper</code>不起作用了。原因是：</p>
<p>如果子<code>View</code>不消耗事件，那么整个手势流程都是直接进入<code>onTouchEvent</code>，在<code>onTouchEvent</code>的<code>DOWN</code>的时候就确定了<code>captureView</code>；</p>
<p>如果消耗事件，那么就会先走<code>onInterceptTouchEvent</code>方法，判断是否可以捕获，而在判断的过程中会去判断另外两个回调的方法：<code>getViewHorizontalDragRange</code>和<code>getViewVerticalDragRange</code>，只有这两个方法返回大于0的值才能正常的捕获。</p>
<p>上面的写法 我只是为了保证 返回值 大于 0，其实只要<code>return</code>大于0的值就可以了，比如直接写 1</p>
</li>
<li><p>ViewDragHelper 的 settleCapturedViewAt 方法</p>
<p>回到指定的<code>left</code>，<code>top</code>的位置。紧随其后的代码是<code>invalidate()</code>;因为其内部使用的是<code>Scroller.startScroll</code>，所以需要<code>invalidate()</code>以及结合<code>computeScroll</code>方法一起。</p>
<p>敲黑板</p>
<p>敲黑板</p>
<p>敲黑板</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">computeScroll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(mDragViewHelper.continueSettling(<span class="keyword">true</span>)) &#123;</span><br><span class="line">      postInvalidate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>ViewDragHelper 的基本使用流程就到这里了。</p>
<h3 id="思路整理"><a href="#思路整理" class="headerlink" title="思路整理"></a>思路整理</h3><h4 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h4><blockquote>
<p><em>两个<code>View</code></em>线性<em>竖向</em>布局，上面的<code>View</code>内容可以进行<em>上下滚动</em>，滚动到<em>底部的时候</em>，可以<em>继续上拉</em>，第二个<code>View</code><em>跟随</em>第一个<code>View</code>上拉出现，拉动到第二个<code>View</code>的高度后<em>停止上拉</em>，<em>松手</em>后第二个<code>View</code><em>回弹</em>消失，<em>此时下拉</em>，仍然可以<em>向上滚动</em>第一个<code>View</code>的内容</p>
</blockquote>
<h4 id="根据思路选择合适的ViewGroup"><a href="#根据思路选择合适的ViewGroup" class="headerlink" title="根据思路选择合适的ViewGroup"></a>根据思路选择合适的ViewGroup</h4><blockquote>
<p>根据上面 <em>斜体</em> 文字的<del>划重点</del> 提示</p>
<p>竖向 ： LinearLayout</p>
<p>上下滚动：ScrollView</p>
</blockquote>
<h4 id="根据选择的ViewGroup决定实现方式"><a href="#根据选择的ViewGroup决定实现方式" class="headerlink" title="根据选择的ViewGroup决定实现方式"></a>根据选择的ViewGroup决定实现方式</h4><blockquote>
<p>只有两个View，要么ScrollView里面套LinearLayout，要么LinearLayout里面套ScrollView</p>
<p>我选的是 前者</p>
</blockquote>
<p>那，动手吧。</p>
<h3 id="动手实现"><a href="#动手实现" class="headerlink" title="动手实现"></a>动手实现</h3><p>先来 <code>LinearLayout</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JimPullBottomView</span> <span class="keyword">extends</span> <span class="title">LinearLayout</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ViewDragHelper mDragViewHelper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> View mDragView;</span><br><span class="line">    <span class="keyword">private</span> View bottomView;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Point mDragViewOri = <span class="keyword">new</span> Point();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JimPullBottomView</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, <span class="keyword">null</span>);</span><br><span class="line">        init(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JimPullBottomView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, -<span class="number">1</span>);</span><br><span class="line">        init(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JimPullBottomView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">        init(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        mDragViewHelper = ViewDragHelper.create(<span class="keyword">this</span>, <span class="number">1.0f</span>, mDragHelperCallback);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ViewDragHelper.Callback mDragHelperCallback = <span class="keyword">new</span> ViewDragHelper.Callback() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">tryCaptureView</span><span class="params">(View child, <span class="keyword">int</span> pointerId)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> child == mDragView;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">clampViewPositionVertical</span><span class="params">(View child, <span class="keyword">int</span> top, <span class="keyword">int</span> dy)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> topBound = -<span class="number">1</span> * bottomView.getMeasuredHeight();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> bottomBound = getHeight() - mDragView.getMeasuredHeight();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> Math.min(Math.max(top, topBound), bottomBound);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">clampViewPositionHorizontal</span><span class="params">(View child, <span class="keyword">int</span> left, <span class="keyword">int</span> dx)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">          	<span class="comment">// 左边限定为 100</span></span><br><span class="line">            <span class="keyword">int</span> leftBound = <span class="number">100</span>; </span><br><span class="line">			<span class="comment">// 右边限定为 400的位置，由于要使用 left 进行布局,所以需要减去mDragView的宽度</span></span><br><span class="line">            <span class="keyword">int</span> rightBound = <span class="number">400</span> - mDragView.getWidth(); /</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> Math.min(Math.max(leftBound, left), rightBound);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onViewReleased</span><span class="params">(View releasedChild, <span class="keyword">float</span> xvel, <span class="keyword">float</span> yvel)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(releasedChild == mDragView) &#123;</span><br><span class="line">                mDragViewHelper.settleCapturedViewAt(mDragViewOri.x, mDragViewOri.y);</span><br><span class="line">                postInvalidate();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onViewPositionChanged</span><span class="params">(View changedView, <span class="keyword">int</span> left, <span class="keyword">int</span> top, <span class="keyword">int</span> dx, <span class="keyword">int</span> dy)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(changedView == mDragView) &#123;</span><br><span class="line">                bottomView.layout(bottomView.getLeft(), top + mDragView.getHeight(), bottomView.getRight(), top+mDragView.getHeight() + bottomView.getMeasuredHeight());</span><br><span class="line">            &#125;</span><br><span class="line">            postInvalidate();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getViewVerticalDragRange</span><span class="params">(View child)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> getMeasuredHeight()-child.getMeasuredHeight();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getViewHorizontalDragRange</span><span class="params">(View child)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> getMeasuredWidth()-child.getMeasuredWidth();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">computeScroll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(mDragViewHelper.continueSettling(<span class="keyword">true</span>)) &#123;</span><br><span class="line">              postInvalidate();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> l, <span class="keyword">int</span> t, <span class="keyword">int</span> r, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onLayout(changed, l, t, r, b);</span><br><span class="line"></span><br><span class="line">        mDragView.layout(getPaddingLeft(), getPaddingTop(), getWidth() - getPaddingRight(), mDragView.getMeasuredHeight());</span><br><span class="line">        bottomView.layout(getPaddingLeft(), mDragView.getBottom(), getWidth() - getPaddingRight(), mDragView.getBottom() + bottomView.getMeasuredHeight());</span><br><span class="line"></span><br><span class="line">        mDragViewOri.x = mDragView.getLeft();</span><br><span class="line">        mDragViewOri.y = mDragView.getTop();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onFinishInflate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onFinishInflate();</span><br><span class="line">        mDragView = getChildAt(<span class="number">0</span>);</span><br><span class="line">        bottomView = getChildAt(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 事件分发</span><br><span class="line">    * <span class="doctag">@param</span> ev</span><br><span class="line">    * <span class="doctag">@return</span></span><br><span class="line">    * 可以根据具体需求决定如何分发事件</span><br><span class="line">    × 这里不做处理</span><br><span class="line">    */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        Log.w(<span class="string">"jimbray"</span>, <span class="string">"dispatchTouchEvent"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.dispatchTouchEvent(ev);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 事件拦截 </span><br><span class="line">    * <span class="doctag">@param</span> ev</span><br><span class="line">    * <span class="doctag">@return</span></span><br><span class="line">    * 直接将所有的事件都交由 ViewDragHelper 去处理</span><br><span class="line">    * 可以根据具体需求决定是否交付事件</span><br><span class="line">    */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        Log.w(<span class="string">"jimbray"</span>, <span class="string">"onInterceptTouchEvent"</span>);</span><br><span class="line">        <span class="keyword">return</span> mDragViewHelper.shouldInterceptTouchEvent(ev);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span><br><span class="line">    * 事件消费</span><br><span class="line">    * <span class="doctag">@param</span> event</span><br><span class="line">    * <span class="doctag">@return</span></span><br><span class="line">    * 直接将所有的事件都交由 ViewDragHelper 去处理</span><br><span class="line">    * 可以根据具体需求决定是否交付事件</span><br><span class="line">    * 交付事件后直接 return true，结束事件</span><br><span class="line">    */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">    	Log.w(<span class="string">"jimbray"</span>, <span class="string">"onTouchEvent"</span>);</span><br><span class="line">        mDragViewHelper.processTouchEvent(event);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">dp2Px</span><span class="params">(<span class="keyword">float</span> dp)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">float</span> scale = getContext().getResources().getDisplayMetrics().density;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) (dp * scale + <span class="number">0.5f</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>好了，先来看看几个点。</p>
<h4 id="两个View"><a href="#两个View" class="headerlink" title="两个View"></a>两个View</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> View mDragView;</span><br><span class="line"><span class="keyword">private</span> View bottomView;</span><br></pre></td></tr></table></figure>
<h4 id="竖向布局"><a href="#竖向布局" class="headerlink" title="竖向布局"></a>竖向布局</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">mDragView.layout(getPaddingLeft(), </span><br><span class="line">                 getPaddingTop(), </span><br><span class="line">                 getWidth() - getPaddingRight(), </span><br><span class="line">                 mDragView.getMeasuredHeight());</span><br><span class="line">bottomView.layout(getPaddingLeft(), </span><br><span class="line">                  mDragView.getBottom(), </span><br><span class="line">                  getWidth() - getPaddingRight(), </span><br><span class="line">                  mDragView.getBottom() + bottomView.getMeasuredHeight());</span><br></pre></td></tr></table></figure>
<p>在<code>onLayout</code>直接布局 使用 layout 方法进行位置布局</p>
<p>该方法是<code>View</code>的放置方法，在<code>View</code>类实现。调用该方法需要传入放置<code>View</code>的矩形空间左上角left、top值和右下角right、bottom值。<em>这四个值是相对于父控件而言的</em>。例如传入的是（10, 10, 100, 100），则该View在距离父控件的左上角位置(10, 10)处显示，显示的大小是长宽是(100-10=90) （参数r,b是相对左上角的）</p>
<h4 id="第二个View-的跟随出现"><a href="#第二个View-的跟随出现" class="headerlink" title="第二个View 的跟随出现"></a>第二个View 的跟随出现</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(changedView == mDragView) &#123;</span><br><span class="line">	bottomView.layout(bottomView.getLeft(), </span><br><span class="line">              top + mDragView.getHeight(), </span><br><span class="line">              bottomView.getRight(), </span><br><span class="line">              top+mDragView.getHeight() + bottomView.getMeasuredHeight());</span><br><span class="line">&#125;</span><br><span class="line">postInvalidate();</span><br></pre></td></tr></table></figure>
<p>第一个<code>View</code> 是 <code>mDragView</code>, 第二个<code>View</code> 是 <code>bottomView</code></p>
<p>既然要跟随出现，那肯定要知道<del>第一个View</del><code>mDragView</code>的位置变化，所以这段代码放在了 <code>onViewPositionChanged</code>里面实现，简单理解一下：</p>
<p>四个参数分别代表：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">changedView : 当前被捕获的 View;</span><br><span class="line">left : View 最终处于的位置的左边位置的坐标;</span><br><span class="line">top : View 最终处于的位置的顶部位置的坐标;</span><br><span class="line">dx : 此次调用距离上次调用时的 x 坐标的 差值;</span><br><span class="line">dy : 此次调用距离上次调用时的 y 坐标的 差值;</span><br></pre></td></tr></table></figure>
<p>如果移动位置的<code>View</code>是<del>第一个<code>View</code></del><code>mDragView</code>的话，<del>第二个`View</del><code>bottomView</code>的位置布局为</p>
<p>left : 左边还是一样的</p>
<p>top: 紧紧跟随<code>mDragView</code>的底部，因为要粘在<code>mDragView</code>的后面嘛</p>
<p>right: 右边也是保持自己的位置</p>
<p>bottom: 只要距离top 自身的高度就可以了</p>
<p><strong>噢，别忘了 <code>invalidate()</code>(与 <code>postInvalidate()</code>的区别不在讨论范围了)</strong></p>
<h4 id="停止上拉"><a href="#停止上拉" class="headerlink" title="停止上拉"></a>停止上拉</h4><p>居然有停止上拉的时候，<del>难道不是随便拉的吗</del>，也就是说，拖动时有范围的，而且效果也看得出来，其实左右是没有办法拖动的。轮到 <code>clampViewPositionVertical</code> 和 <code>clampViewPositionHorizontal</code> 出场了。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">clampViewPositionVertical</span><span class="params">(View child, <span class="keyword">int</span> top, <span class="keyword">int</span> dy)</span> </span>&#123;</span><br><span class="line">  	<span class="keyword">int</span> topBound = -<span class="number">1</span> * bottomView.getMeasuredHeight();</span><br><span class="line">    <span class="keyword">int</span> bottomBound = getHeight() - mDragView.getMeasuredHeight();</span><br><span class="line">    <span class="keyword">return</span> Math.min(Math.max(top, topBound), bottomBound);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">clampViewPositionHorizontal</span><span class="params">(View child, <span class="keyword">int</span> left, <span class="keyword">int</span> dx)</span> </span>&#123;</span><br><span class="line">  	<span class="keyword">int</span> leftBound = mDragView.getLeft();</span><br><span class="line">  	<span class="keyword">int</span> rightBound = mDragView.getRight() - mDragView.getWidth();</span><br><span class="line">  	<span class="keyword">return</span> Math.min(Math.max(leftBound, left), rightBound);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>先来看下横向限制</li>
</ul>
<p>左边限制是 <code>mDragView.getLeft()</code>就是 <code>View</code>的左边</p>
<p>右边限制是 <code>mDragView.getRight() - mDragView.getWidth()</code> 就是 <code>View</code>的右边</p>
<p>也就是说，这个<code>View</code>往左只能到 自己的左边，往右只能到自己的右边，不就是不能移动嘛<del>真可怜</del></p>
<ul>
<li>现在看看竖向限制</li>
</ul>
<p>上边限制是 <code>-1 * bottomView</code> 就是屏幕网上 bottomView的高度</p>
<p>下边限制是 <code>getHeight() - mDragView.getMeasuredHeight()</code> 就是 屏幕高度最底部的位置，也就是无法移动到底部以上了</p>
<h4 id="松手回弹"><a href="#松手回弹" class="headerlink" title="松手回弹"></a>松手回弹</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(releasedChild == mDragView) &#123;</span><br><span class="line">	mDragViewHelper.settleCapturedViewAt(mDragViewOri.x, mDragViewOri.y);</span><br><span class="line">    postInvalidate();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果松手的<code>View</code>是<code>mDragView</code>的话，回弹到 <code>mDragView</code>最原始的 <code>left</code> 和 <code>top</code> 位置。</p>
<p>但，那是哪里呢？那我们就在布局之后记录一下。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">mDragViewOri.x = mDragView.getLeft();</span><br><span class="line">mDragViewOri.y = mDragView.getTop();</span><br></pre></td></tr></table></figure>
<p>写完了，那直接套上用用吧。先布个局</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;ScrollView xmlns:android="http://schemas.android.com/apk/res/android"</span><br><span class="line">    android:id="@+id/root"</span><br><span class="line">    android:layout_width="match_parent"</span><br><span class="line">    android:layout_height="match_parent"</span><br><span class="line">    android:orientation="vertical"&gt;</span><br><span class="line"></span><br><span class="line">    &lt;xyz.jimbray.custom_view.view.JimPullBottomView</span><br><span class="line">        android:layout_width="match_parent"</span><br><span class="line">        android:layout_height="match_parent"</span><br><span class="line">        android:orientation="vertical"</span><br><span class="line">        android:background="#000"&gt;</span><br><span class="line"></span><br><span class="line">        &lt;LinearLayout</span><br><span class="line">            android:layout_width="match_parent"</span><br><span class="line">            android:layout_height="match_parent"</span><br><span class="line">            android:gravity="center"</span><br><span class="line">            android:orientation="vertical"&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:layout_width="100dp"</span><br><span class="line">                android:layout_height="100dp"</span><br><span class="line">                android:layout_margin="10dp"</span><br><span class="line">                android:background="#0af"</span><br><span class="line">                android:gravity="center"</span><br><span class="line">                android:text="A0"</span><br><span class="line">                android:textColor="@android:color/white" /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:layout_width="100dp"</span><br><span class="line">                android:layout_height="100dp"</span><br><span class="line">                android:layout_margin="10dp"</span><br><span class="line">                android:background="#0af"</span><br><span class="line">                android:gravity="center"</span><br><span class="line">                android:text="A1"</span><br><span class="line">                android:textColor="@android:color/white" /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:layout_width="100dp"</span><br><span class="line">                android:layout_height="100dp"</span><br><span class="line">                android:layout_margin="10dp"</span><br><span class="line">                android:background="#0af"</span><br><span class="line">                android:gravity="center"</span><br><span class="line">                android:text="A2"</span><br><span class="line">                android:textColor="@android:color/white" /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:layout_width="100dp"</span><br><span class="line">                android:layout_height="100dp"</span><br><span class="line">                android:layout_margin="10dp"</span><br><span class="line">                android:background="#0af"</span><br><span class="line">                android:gravity="center"</span><br><span class="line">                android:text="A3"</span><br><span class="line">                android:textColor="@android:color/white" /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:layout_width="100dp"</span><br><span class="line">                android:layout_height="100dp"</span><br><span class="line">                android:layout_margin="10dp"</span><br><span class="line">                android:background="#0af"</span><br><span class="line">                android:gravity="center"</span><br><span class="line">                android:text="A4"</span><br><span class="line">                android:textColor="@android:color/white" /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:layout_width="100dp"</span><br><span class="line">                android:layout_height="100dp"</span><br><span class="line">                android:layout_margin="10dp"</span><br><span class="line">                android:background="#0af"</span><br><span class="line">                android:gravity="center"</span><br><span class="line">                android:text="A5"</span><br><span class="line">                android:textColor="@android:color/white" /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:layout_width="100dp"</span><br><span class="line">                android:layout_height="100dp"</span><br><span class="line">                android:layout_margin="10dp"</span><br><span class="line">                android:background="#0af"</span><br><span class="line">                android:gravity="center"</span><br><span class="line">                android:text="A6"</span><br><span class="line">                android:textColor="@android:color/white" /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:layout_width="100dp"</span><br><span class="line">                android:layout_height="100dp"</span><br><span class="line">                android:layout_margin="10dp"</span><br><span class="line">                android:background="#0af"</span><br><span class="line">                android:gravity="center"</span><br><span class="line">                android:text="A7"</span><br><span class="line">                android:textColor="@android:color/white" /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:layout_width="100dp"</span><br><span class="line">                android:layout_height="100dp"</span><br><span class="line">                android:layout_margin="10dp"</span><br><span class="line">                android:background="#0af"</span><br><span class="line">                android:gravity="center"</span><br><span class="line">                android:text="A8"</span><br><span class="line">                android:textColor="@android:color/white" /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:layout_width="100dp"</span><br><span class="line">                android:layout_height="100dp"</span><br><span class="line">                android:layout_margin="10dp"</span><br><span class="line">                android:background="#0af"</span><br><span class="line">                android:gravity="center"</span><br><span class="line">                android:text="A9"</span><br><span class="line">                android:textColor="@android:color/white" /&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextView</span><br><span class="line">                android:layout_width="100dp"</span><br><span class="line">                android:layout_height="100dp"</span><br><span class="line">                android:layout_margin="10dp"</span><br><span class="line">                android:background="#ff00cc"</span><br><span class="line">                android:gravity="center"</span><br><span class="line">                android:text="A10"</span><br><span class="line">                android:textColor="@android:color/white" /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/LinearLayout&gt;</span><br><span class="line"></span><br><span class="line">        &lt;RelativeLayout</span><br><span class="line">            android:layout_width="match_parent"</span><br><span class="line">            android:layout_height="260dp"</span><br><span class="line">            android:background="#EFEF0F"&gt;</span><br><span class="line"></span><br><span class="line">            &lt;ImageView</span><br><span class="line">                android:layout_width="match_parent"</span><br><span class="line">                android:layout_height="260dp"</span><br><span class="line">                android:layout_gravity="center"</span><br><span class="line">                android:adjustViewBounds="true"</span><br><span class="line">                android:scaleType="center"</span><br><span class="line">                android:src="@mipmap/icon" /&gt;</span><br><span class="line">        &lt;/RelativeLayout&gt;</span><br><span class="line">    &lt;/xyz.jimbray.custom_view.view.JimPullBottomView&gt;</span><br><span class="line"></span><br><span class="line">&lt;/ScrollView&gt;</span><br></pre></td></tr></table></figure>
<p>看看效果怎么样</p>
<p><img src="http://7xv11f.com1.z0.glb.clouddn.com/surpriseBottomView-unfinished-1.gif" alt=""></p>
<p>为什么会这样呢？刚刚那么辛苦算的拖动到位置什么的，都不生效了！摔</p>
<p>仔细想想，滑动得怎么欢快，应该是<code>ScrollView</code> 自己处理的所有的 <code>touch</code> 事件，完全没有交给 <code>ViewDragHelper</code> 去处理嘛（不交给TA处理，我们写的东西当然没效果啦）。那这里就要学习到 <code>touch</code> 事件的拦截处理了。</p>
<p>首先先继承一下 <code>ScrollView</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"jimbray"</span>, <span class="string">"scrollview dispatchTouchEvent"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.dispatchTouchEvent(ev);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"jimbray"</span>, <span class="string">"scrollview onInterceptTouchEvent"</span>);</span><br><span class="line">        <span class="keyword">int</span> action = ev.getActionMasked();</span><br><span class="line">        <span class="keyword">switch</span>(action) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                lastY = ev.getY();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">                <span class="keyword">float</span> curY = ev.getY();</span><br><span class="line">                <span class="keyword">int</span> deltaY = (<span class="keyword">int</span>) (curY - lastY);</span><br><span class="line">                lastY = curY;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(deltaY &lt; <span class="number">0</span>) &#123; <span class="comment">//手指往上划动</span></span><br><span class="line">                    <span class="keyword">if</span>(isScrollToBottom()) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onInterceptTouchEvent(ev);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"jimbray"</span>, <span class="string">"scrollview onTouchEvent"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(ev);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><code>dispatchTouchEvent</code> 和 <code>onTouchEvent</code> 都是调用 <code>super</code> ,其实不重载也没有关系（这个例子里），</p>
<p>关键在于 <strong>事件拦截</strong> <strong><code>onInterceptTouchEvent</code></strong> 的处理</p>
<p>为什么要处理拦截事件呢？现在遇到的问题就是 <code>ScrollView</code>将所有的 <code>touch</code>事件都拦截了，子<code>View</code>里面根本没有办法施展拳脚，所以我们要做的事情就是 让 <code>ScrollView</code> 在适当的时候交出控制权，其他时候还是 交给 <code>ScrollView</code>爱怎么滚怎么滚。那现在问题来了：什么是适当的时候呢？</p>
<p><strong>上面的<code>View</code>内容可以进行<em>上下滚动</em>，滚动到<em>底部的时候</em>，可以<em>继续上拉</em>，第二个<code>View</code><em>跟随</em>第一个<code>View</code>上拉出现</strong></p>
<h4 id="上下滚动"><a href="#上下滚动" class="headerlink" title="上下滚动"></a>上下滚动</h4><p>说明这个时候是交给 <code>ScrollView</code> 自己去处理的。因为上下滚动这个活对于 <code>ScrollView</code> 来说已经驾轻就熟了</p>
<h4 id="滚动到底部的时候"><a href="#滚动到底部的时候" class="headerlink" title="滚动到底部的时候"></a>滚动到底部的时候</h4><p>这个时候继续上拉这个活，就是我们刚刚 在 <code>LinearLayout</code> 做的事情了。</p>
<p>现在明白了什么时候 我们的 <code>LinearLayout</code> 要从 <code>ScrollView</code> 里面抢活，可以开始了。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">    lastY = ev.getY();</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">    <span class="keyword">float</span> curY = ev.getY();</span><br><span class="line">    <span class="keyword">int</span> deltaY = (<span class="keyword">int</span>) (curY - lastY);</span><br><span class="line">    lastY = curY;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(deltaY &lt; <span class="number">0</span>) &#123; <span class="comment">//手指往上划动</span></span><br><span class="line">      	<span class="keyword">if</span>(isScrollToBottom()) &#123;</span><br><span class="line">        	<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      	&#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>这里要结合 上面 事件分发机制的 学习笔记来看。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br></pre></td></tr></table></figure>
<p>与</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="keyword">super</span>.onInterceptTouchEvent(ev);</span><br></pre></td></tr></table></figure>
<p>分别代表了什么意义。</p>
<p>主要是对<code>DOWN</code>跟<code>MOVE</code> 事件的处理</p>
<p><code>DOWN</code>的时候记录按下位置</p>
<p><code>MOVE</code>的时候判断是手指往上划还是往下划</p>
<p>只有往上划的时候才有可能会使用到我们的<code>LinearLayout</code></p>
<p>仅仅有往上划还不行，如果没有划动到 <code>ScrollView</code> 的最底部，那<code>touch</code>事件应该还是交给 <code>ScrollView</code> 来滚</p>
<p>当两个条件同时满足的时候，我们的 <code>ViewDragHelper</code> 就要出场了。</p>
<p>现在把 <code>ScrollView</code> 换成我们刚写的 <code>JimPullScrollView</code>，看效果了。</p>
<p><img src="http://7xv11f.com1.z0.glb.clouddn.com/surpriseBottomView-unfinished-1.gif" alt=""></p>
<p>这什么鬼？！不是贴错图了吧，怎么跟刚刚一模一样，白写了。</p>
<p>别急，效果是一样的，可以 <code>touch</code> 事件的拦截可是生效了的，不信把 <code>JimPullScrollView</code> 和 <code>JimPullBottomView</code> 的事件拦截方法就打印个日志看看。<del>我可是从来不骗人的。咦，我为什么要划掉</del></p>
<p>那是什么原因导致 scrollView 把全部都显示出来了呢？</p>
<p>嗯~/托腮，因为 <code>ScrollView</code> 默认显示的就是 子 <code>View</code>的高度啊（包括mDragView 和 bottomView）</p>
<p>那我把 子<code>View</code>的高度限定一下吧。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> l, <span class="keyword">int</span> t, <span class="keyword">int</span> r, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onLayout(changed, l, t, r, b);</span><br><span class="line">        contentView.layout(getPaddingLeft(), </span><br><span class="line">                getPaddingTop(), </span><br><span class="line">                getWidth()-getPaddingRight(), </span><br><span class="line">                contentView.getHeight() - (bottomView.getMeasuredHeight()));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><code>layout</code>重出江湖，<code>left</code>, <code>top</code>, <code>right</code> 就不说了，还是按照原先的方式来。</p>
<p>主要看下 <code>bottom</code>的位置</p>
<p><code>contentView.getHeight() - (bottomView.getMeasuredHeight())</code></p>
<p><code>contentView</code>的高度 减去 <code>bottomView</code> 的高度 = ?</p>
<p><code>contentView</code> 就是 我们的 <code>LinearLayout</code>，高度是 <code>mDragView</code> 和<code>bottomView</code> 的总和</p>
<p>最终结果显而易见 ? = mDragView 的高度</p>
<p>这样的话，<code>SrcrollView</code>的显示就只有 <code>mDragView</code> 的高度了。</p>
<p>想要看见 bottomView ，就要通过 ViewDragHelper 的上拉处理了。</p>
<p>完成</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.jimbray.custom_view.view;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.util.AttributeSet;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"><span class="keyword">import</span> android.view.MotionEvent;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.view.ViewGroup;</span><br><span class="line"><span class="keyword">import</span> android.widget.ScrollView;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line"> * Created by Jimbray  .</span><br><span class="line"> * on 2017/1/4</span><br><span class="line"> * Email: jimbray16@gmail.com</span><br><span class="line"> * Description: TODO</span><br><span class="line"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JimPullScrollView</span> <span class="keyword">extends</span> <span class="title">ScrollView</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> View contentView;</span><br><span class="line">    <span class="keyword">private</span> View bottomView;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> lastY;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JimPullScrollView</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, <span class="keyword">null</span>);</span><br><span class="line">        init(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JimPullScrollView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, -<span class="number">1</span>);</span><br><span class="line">        init(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JimPullScrollView</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">        init(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"jimbray"</span>, <span class="string">"scrollview dispatchTouchEvent"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.dispatchTouchEvent(ev);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"jimbray"</span>, <span class="string">"scrollview onInterceptTouchEvent"</span>);</span><br><span class="line">        <span class="keyword">int</span> action = ev.getActionMasked();</span><br><span class="line">        <span class="keyword">switch</span>(action) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</span><br><span class="line">                lastY = ev.getY();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</span><br><span class="line">                <span class="keyword">float</span> curY = ev.getY();</span><br><span class="line">                <span class="keyword">int</span> deltaY = (<span class="keyword">int</span>) (curY - lastY);</span><br><span class="line">                lastY = curY;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(deltaY &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(isScrollToBottom()) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onInterceptTouchEvent(ev);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        Log.d(<span class="string">"jimbray"</span>, <span class="string">"scrollview onTouchEvent"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(ev);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> l, <span class="keyword">int</span> t, <span class="keyword">int</span> r, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onLayout(changed, l, t, r, b);</span><br><span class="line">        contentView.layout(getPaddingLeft(), </span><br><span class="line">                   getPaddingTop(), </span><br><span class="line">                   getWidth()-getPaddingRight(), </span><br><span class="line">                   contentView.getHeight() - (bottomView.getMeasuredHeight()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onFinishInflate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onFinishInflate();</span><br><span class="line">        contentView = getChildAt(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//在这里获取bottomView</span></span><br><span class="line">        bottomView = ((ViewGroup)contentView).getChildAt(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span><br><span class="line">     * 判断是否划动到了底部 </span><br><span class="line">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isScrollToBottom</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getScrollY() + getHeight() &gt;= computeVerticalScrollRange();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">dp2Px</span><span class="params">(<span class="keyword">float</span> dp)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">float</span> scale = getContext().getResources().getDisplayMetrics().density;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) (dp * scale + <span class="number">0.5f</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过这个效果的实现，学习了<code>touch</code> 事件的拦截，以及<code>ViewDragHelper</code> 的基本使用。</p>
<p>感觉自己棒棒哒</p>

      
    </div>

    <div>
      
        
      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Android/" rel="tag">#Android</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/12/28/one-key post-to-facebook/" rel="next" title="Android 一键发布 Facebook 帖文">
                <i class="fa fa-chevron-left"></i> Android 一键发布 Facebook 帖文
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/02/15/getPersonalSS/" rel="prev" title="最简单方式拥有自己的SS服务器">
                最简单方式拥有自己的SS服务器 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2017/01/06/suppriseBottomView/"
           data-title="ScrollView 与 ViewDragHelper 的混合使用学习" data-url="http://jimbray.github.io/2017/01/06/suppriseBottomView/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://7xv11f.com1.z0.glb.clouddn.com/V.jpg"
               alt="jimbray" />
          <p class="site-author-name" itemprop="name">jimbray</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">16</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#涉及到的知识点"><span class="nav-number">1.</span> <span class="nav-text">涉及到的知识点</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ViewGroup-的事件分发拦截机制"><span class="nav-number">1.1.</span> <span class="nav-text">ViewGroup 的事件分发拦截机制</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#dispatchTouchEvent"><span class="nav-number">1.1.1.</span> <span class="nav-text">dispatchTouchEvent</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#onInterceptTouchEvent"><span class="nav-number">1.1.2.</span> <span class="nav-text">onInterceptTouchEvent</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#onTouchEvent"><span class="nav-number">1.1.3.</span> <span class="nav-text">onTouchEvent</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ViewDragHelper-的基本使用"><span class="nav-number">1.2.</span> <span class="nav-text">ViewDragHelper 的基本使用</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#创建实例"><span class="nav-number">1.2.1.</span> <span class="nav-text">创建实例</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Touch-事件分发拦截的相关处理"><span class="nav-number">1.2.2.</span> <span class="nav-text">Touch 事件分发拦截的相关处理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ViewDragHelper-callback-的实现"><span class="nav-number">1.2.3.</span> <span class="nav-text">ViewDragHelper callback 的实现</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#思路整理"><span class="nav-number">2.</span> <span class="nav-text">思路整理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#需求分析"><span class="nav-number">2.1.</span> <span class="nav-text">需求分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#根据思路选择合适的ViewGroup"><span class="nav-number">2.2.</span> <span class="nav-text">根据思路选择合适的ViewGroup</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#根据选择的ViewGroup决定实现方式"><span class="nav-number">2.3.</span> <span class="nav-text">根据选择的ViewGroup决定实现方式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#动手实现"><span class="nav-number">3.</span> <span class="nav-text">动手实现</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#两个View"><span class="nav-number">3.1.</span> <span class="nav-text">两个View</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#竖向布局"><span class="nav-number">3.2.</span> <span class="nav-text">竖向布局</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#第二个View-的跟随出现"><span class="nav-number">3.3.</span> <span class="nav-text">第二个View 的跟随出现</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#停止上拉"><span class="nav-number">3.4.</span> <span class="nav-text">停止上拉</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#松手回弹"><span class="nav-number">3.5.</span> <span class="nav-text">松手回弹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#上下滚动"><span class="nav-number">3.6.</span> <span class="nav-text">上下滚动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#滚动到底部的时候"><span class="nav-number">3.7.</span> <span class="nav-text">滚动到底部的时候</span></a></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jimbray</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"jimbray"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  





  
  
  

  

  

</body>
</html>
