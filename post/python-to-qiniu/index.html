<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="仅仅是完成了基础需求">
  <meta name="generator" content="Hugo 0.31.1" />

  <title>简化markdown写作中的贴图流程（windows简陋版） &middot; JIMBRAY</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://jimbray.xyz/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://jimbray.xyz/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://jimbray.xyz/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://jimbray.xyz/img/favicon.ico" type="image/x-icon" />

  
  


<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-8790496632299830",
    enable_page_level_ads: true
  });
</script>
<meta name="google-site-verification" content="lsfTBJKzPUfwHdKB84_xsa5u_38z1iLbcGOAkxOo03Q" />

  
</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://jimbray.xyz/">Jimbray</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://jimbray.xyz/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://jimbray.xyz/post/"><i class='fa fa-archive fa-fw'></i>Archive</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://jimbray.xyz/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://jimbray.xyz/note/note"><i class='fa fa-sticky-note fa-fw'></i>Notes</a>
      
        </li>
      
    </ul>
  </div>

  
  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/jimbray16" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/jimbray" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>

  
  <div>
  <div class="small-print">
    <small>&copy; 2016. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

  
  



  
  
  
  
	

</div>


  <div id="main">


<div class="header">
  <h1>简化markdown写作中的贴图流程（windows简陋版）</h1>
  <h2>仅仅是完成了基础需求</h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>14 Jun 2016, 23:59</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://jimbray.xyz/tags/python">Python</a>
    
  </div>
  
  

</div>

  

<p>上次在网上闲逛的时候看到一篇文章</p>

<p><a href="http://www.jianshu.com/p/7bd4e6ed99be/comments/1794317#comment-1794317">简化markdown写作中的贴图流程</a></p>

<p>刚好最近也在学习python，看起来好有趣啊，这篇文章讲的是Mac上的，
我没有Mac，只有Windows，文章里面也写了Windows系统的实现思路，既然作者已经给出来了，作为一个python初学者，动动手罢</p>

<h3 id="思路">思路</h3>

<ol>
<li>截图（保存在剪贴板中）</li>
<li>使用七牛sdk 上传剪切板中的图片</li>
<li>获取返回的url，并合成 markdown 贴图语法
应该就可以了吧</li>
</ol>

<h3 id="实现">实现</h3>

<h4 id="准备工作">准备工作</h4>

<ol>
<li>安装 七牛python sdk,我用的是IDE pycharm 方式
<img src="http://driver.365yhb.cn/%E4%B8%83%E7%89%9Bpython_sdk.jpg" alt="qiniu_sdk.jpg" /></li>
<li>下载安装 <a href="https://autohotkey.com/download/">AutoHotKey</a> 软件</li>
<li>写 python代码</li>
<li>写AutoHotKey脚本</li>
</ol>

<h4 id="开始动手">开始动手</h4>

<p>写代码
由于技术太渣，搜到又看不懂win32什么的，最后获取剪贴板截图的功能没能写出来，找到了另一个库 PIL
这个库的截图也是在剪切板的，不过不是其他软件接下来的，是系统截下来的 screencapture</p>

<pre><code class="language-python">AK = 'access_key'
SK = 'secret_key'
bucket_name = &quot;bucket_name&quot;
buckey_url = {
    'bucket_name': 'domain_name',
}
</code></pre>

<p>上面是一些初始化工作
都是七牛的东西
可以在 七牛的 开发者帐号里面找到
access_key 和 secret_key 就不说了
bucket_name 是 空间名称
domain_name 是 空间域名</p>

<!-- more -->

<p>继续:获取图片</p>

<pre><code class="language-python">def save_clipboard_image():
    pic = ImageGrab.grab()
    saved_path = &quot;img_&quot; + str(time.time()) + &quot;.jpg&quot;;
    pic.save(saved_path)
    return saved_path
</code></pre>

<p>获取系统截图，然后保存在一个文件名为当前时间的jpg文件中
返回保存的文件路径</p>

<p>继续：上传图片</p>

<pre><code class="language-python">class Qiniu():
    def __init__(self, ak, sk):
        self.access_key = ak
        self.secret_key = sk
        self._q = qiniu.Auth(self.access_key, self.secret_key)

    def upload_file(self, bucket_name, key, file_path):
        #生成上传 Token，可以指定过期时间等
        token = self._q.upload_token(bucket_name, key, 3600)
        ret, info = put_file(token, key, file_path)
        print(info)
        pic_url = self.get_pic_url(bucket_name, file_path)
        add_to_clipboard(pic_url, file_path)

    def get_pic_url(self, bucket_name, file_path):
        result = buckey_url[bucket_name] + file_path
        return result
</code></pre>

<p>上传图片的 功能都是 七牛sdk 提供的，sdk demo里面都有，也没什么好说的了
上面有个 add_to_clipboard 方法</p>

<pre><code class="language-python">def add_to_clipboard(pic_url, file_name):
    txt = '![' + file_name +']('+ pic_url +')'
    print(txt)
    command = 'echo ' + txt.strip() + '| clip'
    os.system(command)
</code></pre>

<p>工作就是把上传完成之后的图片路径 转换成 markdown 语法，并复制到剪贴板
还剩一个入口函数</p>

<pre><code class="language-python">if __name__ == '__main__':
    saved_path = save_clipboard_image()
    q = Qiniu(AK, SK)
    q.upload_file(bucket_name, saved_path, saved_path)
</code></pre>

<p>需要导入的库</p>

<pre><code class="language-python">from PIL import ImageGrab
import time
from qiniu import Auth, put_file
import os
</code></pre>

<p>好像就写完了
运行以下，去七牛空间上看，就会多一张图片，以一串数字命名
然后新建一个 txt 文档，ctrl-v 以下，就能看到一个字符串啦，是在markdown插入图片的语法</p>

<p>继续：设置触发
接下来要上场的是 windows 下的 神器 AutoHotKey，我也是看前面那个文章才知道的
工作主要是 触发这个python文件的执行
那我就偷懒了一下
使用 ctrl+alt+v触发python</p>

<pre><code class="language-ahk">^!v::
run,%comspec% /c python D:\python\upload.py
</code></pre>

<p>^代表ctrl键
!代码alt键
v代表v键（废话）
工作就是按键之后，执行 cmd 然后输入命令
python D:\python\upload.py
运行起来
执行一下，上传成功，可是每张图片都被 cmd 那个黑框框挡住了
google了以下
答案是</p>

<pre><code class="language-ahk">run,%comspec% /c python D:\python\upload.py ,, hide
</code></pre>

<p>后面加上一个 hide
就不会出现黑框框了。
到这里应该就是把这个功能的简陋版弄出来了
等之后有时间了，学习更多了，在优化以下，减少硬编码</p>

<p>我的第一个 python 功能就这么完成了。
哈。
试试效果</p>

<p><img src="http://driver.365yhb.cn/python%E5%8A%9F%E8%83%BD%E6%95%88%E6%9E%9C.jpg" alt="试试效果.jpg" /></p>

<p>快12点了
早睡早起身体好。</p>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://jimbray.xyz/post/facebook-share-not-callback/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://jimbray.xyz/post/facebook-share-not-callback/">Facebook ShareDialog 没有回调的问题</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://jimbray.xyz/post/python-to-qiniu2/">简化markdown写作中的贴图流程（windows基本版）</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://jimbray.xyz/post/python-to-qiniu2/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'jimbray-github-io';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</div>

</div>
</div>
<script src="https://jimbray.xyz/js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-78813427-1', 'auto');
  ga('send', 'pageview');

</script>





</body>
</html>

