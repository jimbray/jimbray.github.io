<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="使用Facebook官方API发布POST">
  <meta name="generator" content="Hugo 0.81.0" />

  <title>Android 一键发布 Facebook 帖文 &middot; 我说的这句话是谎话</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://jimbray.xyz/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://jimbray.xyz/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://jimbray.xyz/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://jimbray.xyz/img/favicon.ico" type="image/x-icon" />

  
  


<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-8790496632299830",
    enable_page_level_ads: true
  });
</script>
<meta name="google-site-verification" content="lsfTBJKzPUfwHdKB84_xsa5u_38z1iLbcGOAkxOo03Q" />

  
</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="https://jimbray.xyz/">Jimbray</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://jimbray.xyz/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://jimbray.xyz/post/"><i class='fa fa-archive fa-fw'></i>Archive</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://jimbray.xyz/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://jimbray.xyz/note/note"><i class='fa fa-sticky-note fa-fw'></i>Notes</a>
      
        </li>
      
    </ul>
  </div>

  
  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/jimbray16" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/jimbray" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>

  
  <div>
  <div class="small-print">
    <small>&copy; 2016. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

  
  



  
  
  
  
	

</div>


  <div id="main">


<div class="header">
  <h1>Android 一键发布 Facebook 帖文</h1>
  <h2>使用Facebook官方API发布POST</h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>28 Dec 2016, 13:00</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://jimbray.xyz/tags/android">Android</a>
    
  </div>
  
  

</div>

  <p>一般遇到的需求都是做分享操作，现在国内已经有很多一键分享的 SDK了，而且还封装得不错，就是权限要得比较多。</p>
<p>今天需要做的是  跟 Path APP 一样，在自己的 APP 发布post时，同步发送到 <del>其他平台</del>Facebook。</p>
<h3 id="先把基本配置做了">先把基本配置做了</h3>
<blockquote>
<ul>
<li>將 <strong>Facebook Android SDK</strong> 新增至您的行動開發環境</li>
<li>取得正確設定並連結至 Android 應用程式的 <strong>Facebook 應用程式編號</strong>。請參閱 <a href="https://developers.facebook.com/docs/android/getting-started#app_id">Android 新手指南，新增 Facebook 應用程式編號</a></li>
<li>產生 <strong>Android 金鑰雜湊</strong>並新增至<a href="https://developers.facebook.com/settings/developer/contact/">開發人員個人檔案</a></li>
<li><strong>新增 Facebook Activity</strong> - 請將本項目加至 `AndroidManifest.xml</li>
</ul>
</blockquote>
<h3 id="开始分享">开始分享</h3>
<h4 id="建立内容模板">建立内容模板</h4>
<p>模板有几种方式</p>
<ul>
<li>Link</li>
<li>Photos</li>
<li>Videos</li>
<li>Multimedia</li>
</ul>
<p>参见<a href="https://developers.facebook.com/docs/sharing/android?locale=en_US">Facebook官方文档</a></p>
<h4 id="最终使用">最终使用</h4>
<pre><code>ShareApi.share(content, null);
</code></pre><p>即可发送成功</p>
<p>但是发送的样式 跟 使用那些 一键分享的 SDK 是一样的</p>
<p>都是那种感觉像 转发 的形式。（会看到 发送的对话框，类似于 ShareDialog）</p>
<!-- raw HTML omitted -->
<h4 id="后台发送">后台发送</h4>
<p>仔细看了文档，发现了一个 <a href="https://developers.facebook.com/docs/graph-api">Graph API </a></p>
<p>而且还提供了 <a href="https://developers.facebook.com/docs/graph-api/common-scenarios">案例</a>，也有各个平台的SDK使用，用起来很方便。</p>
<h5 id="are-two-people-facebook-friends-判断两人是否为朋友">Are two people Facebook friends? （判断两人是否为朋友）</h5>
<ul>
<li><a href="https://developers.facebook.com/docs/graph-api/reference/user/friends/#readmodifiers"><code>/{user-a-id}/friends/{user-b-id}</code></a> - this API Read modifier will let you check via API.</li>
</ul>
<h5 id="publishing-new-status-updates-发布新的近况">Publishing new Status Updates （发布新的近况）</h5>
<ul>
<li><a href="https://developers.facebook.com/docs/graph-api/reference/user/albums/#publish"><code>/{user-id}/albums</code></a> to create empty photo albums for people.</li>
<li><a href="https://developers.facebook.com/docs/graph-api/reference/user/photos/#publish"><code>/{user-id}/photos</code></a> to add individual photos for people.</li>
<li><a href="https://developers.facebook.com/docs/graph-api/reference/page/albums#publish"><code>/{page-id}/albums</code></a> to create empty photo albums for Facebook Pages.</li>
<li><a href="https://developers.facebook.com/docs/graph-api/reference/page/photos/#publish"><code>/{page-id}/photos</code></a> to add individual photos for Facebook Pages.</li>
<li><a href="https://developers.facebook.com/docs/reference/api/album/#photos"><code>/{album-id}/photos</code></a> to add photos to an existing album for people or for Pages.</li>
<li><a href="https://developers.facebook.com/docs/graph-api/reference/user/videos/"><code>/{user-id}/videos</code></a> to update an user&rsquo;s videos.</li>
<li><a href="https://developers.facebook.com/docs/graph-api/reference/page/videos/"><code>/{page-id}/videos</code></a> to update an page&rsquo;s videos.</li>
<li><a href="https://developers.facebook.com/docs/graph-api/reference/event/videos/"><code>/{event-id}/videos</code></a> to update an event&rsquo;s videos.</li>
</ul>
<h5 id="sharing-links-分享链接">Sharing Links （分享链接）</h5>
<ul>
<li><a href="https://developers.facebook.com/docs/graph-api/reference/user/feed/#publish"><code>/{user-id}/feed</code></a> for people on Facebook, using the <code>link</code> field.</li>
<li><a href="https://developers.facebook.com/docs/graph-api/reference/page/feed/#publish"><code>/{page-id}/feed</code></a> for Facebook Pages, using the <code>link</code> field.</li>
</ul>
<p>等等&hellip;&hellip;具体参见<a href="https://developers.facebook.com/docs/graph-api/common-scenarios">文档</a></p>
<h3 id="权限申请">权限申请</h3>
<p>根据需求写了一个方法，用于发布 文字近况 和 图片近况</p>
<pre><code>public static void share2FBInBackground(String img_url, String des) {
        if(TextUtils.isEmpty(img_url)) {
            if(!TextUtils.isEmpty(des)) {
                Bundle params = new Bundle();
                params.putString(&quot;message&quot;, des);
                /* make the API call */
                new GraphRequest(
                        AccessToken.getCurrentAccessToken(),
                        &quot;/me/feed&quot;,
                        params,
                        HttpMethod.POST,
                        new GraphRequest.Callback() {
                            public void onCompleted(GraphResponse response) {
                                DebugUtils.LOG_D(TAG, &quot;post text complete&quot;);
                                /* handle the result */
                            }
                        }
                ).executeAsync();
            }

        } else {
            Bundle params = new Bundle();
            params.putString(&quot;url&quot;, img_url);
            if(!TextUtils.isEmpty(des)) {
                params.putString(&quot;caption&quot;, des);
            }
            /* make the API call */
            new GraphRequest(
                    AccessToken.getCurrentAccessToken(),
                    &quot;/me/photos&quot;,
                    params,
                    HttpMethod.POST,
                    new GraphRequest.Callback() {
                        public void onCompleted(GraphResponse response) {
                        /* handle the result */
                            DebugUtils.LOG_D(TAG, &quot;post photos complete&quot;);
                        }
                    }
            ).executeAsync();
        }
    }
</code></pre><p>可是</p>
<p>每次都不成功！</p>
<p>原来 Facebook 发布还需要权限，还需要申请（publish_actions）</p>
<p>那就在 发布之前 加一个 判断吧</p>
<p>是否有权限发布</p>
<pre><code>public static boolean hasPublishPermission() {
    AccessToken accessToken = AccessToken.getCurrentAccessToken();
    return accessToken != null &amp;&amp; accessToken.getPermissions().contains(&quot;publish_actions&quot;);
}
</code></pre><p>那，怎么申请权限呢？</p>
<pre><code>public static void loginWithPublishPermission(Activity activity, final 			FacebookCallback&lt;LoginResult&gt; callback) {
        // 允许使用的权限
        String permission[] = new String[]{&quot;publish_actions&quot;};
        LoginManager.getInstance().logInWithPublishPermissions(activity, Arrays.asList(permission));
        LoginManager.getInstance().registerCallback(mCallbackManager, callback);
    }
</code></pre><p>做了做些操作，应该可以发布成功了。</p>
<p>但是， <code>publish_actions</code> 这个权限是需要申请并审核的。</p>
<p>那就去申请好了。</p>
<p>进入 开发者账号&ndash;选中应用&ndash;选择 App-Review &ndash;选择 Submit Items for Approval&ndash;添加 需要的权限</p>
<p>然后 Edit Notes 看下 审核需要做哪些事情。</p>
<p>可严格了</p>
<ul>
<li>My app does not auto-populate the user message field</li>
<li>My app does not use the Facebook <a href="https://developers.facebook.com/docs/sharing/reference/feed-dialog/">Feed Dialog</a> or the Facebook <a href="https://developers.facebook.com/docs/sharing/reference/share-dialog">Share Dialog</a> to publish content</li>
<li>The share button has clear Facebook branding</li>
<li>My app does not post to Facebook automatically</li>
</ul>
<p>还要录制一个视频</p>
<p>You must show:</p>
<ol>
<li>How a person starts your app and logs in to Facebook login</li>
<li>How a person shares to Facebook from your app</li>
<li>How the post looks on the person&rsquo;s Facebook timeline after posting</li>
</ol>
<p>比写代码还麻烦。</p>
<p>还有一个问题，我想测试我写的代码是否能发布出去呢，现在权限还没有申请下来。</p>
<p>没关系，facebook 提供了一个 测试账号（需要自己添加）</p>
<p>左侧边栏&ndash;Roles&ndash;Test Users</p>
<p>然后使用新增的用户，用刚才的代码，就可以进行发布测试了。</p>
<p>流水帐式记录。Done.</p>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://jimbray.xyz/post/my-third-customview/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://jimbray.xyz/post/my-third-customview/">我的第三个自定义View</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://jimbray.xyz/post/supprisebottomview/">ScrollView 与 ViewDragHelper 的混合使用学习</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://jimbray.xyz/post/supprisebottomview/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'jimbray-github-io';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</div>

</div>
</div>
<script src="https://jimbray.xyz/js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-78813427-1', 'auto');
  ga('send', 'pageview');

</script>





</body>
</html>

